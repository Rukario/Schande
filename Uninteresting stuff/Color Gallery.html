<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="user-scalable=0">
<title>Color Gallery</title>
<style>
body {caret-color:#ffbbff; font-family:courier; font-size:14px; -webkit-user-select:none; user-select:none;}
/* :root {color-scheme: light dark; body {background-color: Canvas;}} */
::selection {background:rgba(255, 192, 255, 0.25);}
[contenteditable]:focus, input:focus {outline:none;}
.editor {padding:8px 12px; min-width:606px; min-height:12px; line-height:1.1; white-space:pre-wrap;}
a {color:#ccbb77;}
a:visited {color:#efdfa8;}
img {vertical-align:top;}
h3 {margin:4px;}
.colorset{color:#bfddc6; cursor:pointer;}
.colorsel{background-color:#c60; color:#fc3;}
.hyperlink{color:#bfddc6; text-decoration:underline;}
.blink{animation: bl 1000ms steps(1, end) infinite;}
@keyframes bl{0%{opacity:75%;} 50%{opacity:100%;}}
input[type="text"] {padding:3px 11px; width:86px;} /*Firefox: padding:3px 11px 4px;*/
input[type="file"] {display: none;}
input[type="color"] {width:0; height:0; padding:0; margin:0; border:0; opacity:0;}
ul {display:inline-grid; grid-template-rows:repeat(20, 1fr); grid-auto-flow:column; grid-column-gap:10px; list-style:none; padding:0; margin:0;}
::placeholder {color:#3cb;}
.cell {background-color:#333; border:2px solid #000; position:relative; display:inline-block; width:75px; height:44px; cursor:pointer; line-height:1.1;}
.mcell {background-color:#333; border:1px solid #000; position:relative; display:inline-block; width:18px; height:11px; cursor:pointer;}
#colortable{line-height:0;}
#minimap{line-height:0;}
.previous, .reverse, .inverse, .next, .tangerine, .brown {white-space:nowrap; font-family:sans-serif; font-size:90%; position:relative; display:inline-block; border:1px solid #033; border-radius:0px; padding:4px 11px; margin:2px; line-height:1.1;}
.next {color:#6fe; background-color:#066;}
.previous {color:#6fe; background-color:#399;}
.reverse {background-color:#428; color:#d9f; border:1px solid #214;}
.inverse {background-color:#d9f; color:#428; border:1px solid #214;}
.tangerine {background-color:#c60; color:#fc3; border:1px solid #842;}
.brown {background-color:#620; color:#620; border:1px solid #842;}

.dark {background-color:rgba(0, 0, 0, 0.5); color:#fff; border:none; border-radius:10px; cursor:pointer;}
.close_button {position:absolute; top:15px; right:15px; cursor:pointer;}
.cursor_tooltip {padding:0px 8px; font-family:sans-serif; font-size:90%; position:absolute; z-index:2; left:0px; top:0px; right:initial; display:none; pointer-events:none;}
#cursor_focus{position:absolute; left:0px; top:0px; right:initial; pointer-events:none;}
.frame {display:inline-block; vertical-align:top; position:relative;}
.dot {height:10px; width:10px; background-color:#333; border-radius:6px; display:inline-block;}
.stdout {white-space:pre-wrap; color:#9b859d; background-color:#110c13; border:2px solid #221926; display:inline-block; padding:6px; min-height:0px;}
.schande{opacity:0.5; position:absolute; top:158px; text-align:center; line-height:34px; height:34px; cursor:pointer; min-width:40px; border:2px solid transparent; background-clip: padding-box; box-shadow:inset 0 0 0 2px #c44; padding:2px; background-color:#602; color:#f45;}
.save{box-shadow:inset 0 0 0 2px #367; background-color:#142434; color:#2a9;}
.spinner {position:absolute; border-top:9px solid #6cc; height:6px; width:3px; top:162px; left:24px; pointer-events:none; animation-name:spin; animation-duration: 700ms; animation-timing-function: linear;}
.left {position:absolute; border-bottom:2px solid #f66; border-left:2px solid #f66; height:5px; width:5px; transform:rotate(45deg); top:166px; left:86px; pointer-events:none;}
.right {position:absolute; border-bottom:2px solid #6cc; border-left:2px solid #6cc; height:5px; width:5px; transform:rotate(225deg); top:166px; left:21px; pointer-events:none;}
@keyframes spin {
  from {
    transform:rotate(0deg);
  }
  to {
    transform:rotate(360deg);
  }
}

.menu {background-color:#110c13; color:#9b859d;}
.exitmenu {background-color:#10100c; color:#088;}

</style>
<script>
var fc = {"black":"#000000", "anubis":"#292220", "mold":"#222922", "machine":"#202229", "concrete":"#666666", "smoke":"#999999", "cream":"#dcd6cc", "white":"#ffffff", "galaxy":"#111114", "wine":"#500040", "purple":"#992282", "magenta":"#ff33e2", "maroon":"#820045", "rose":"#d60159", "orchid":"#ff6c9b", "cherry blossom":"#ffc9e8", "raspberry":"#aa5c7b", "garnet":"#770017", "cherry":"#d9002b", "cerise":"#ff464e", "rouge":"#ffb9c0", "puce":"#aa7370", "crimson":"#771700", "red":"#c7291b", "scarlet":"#f35548", "chestnut":"#bd3f20", "coral":"#f1876a", "jovial":"#f7c3b3", "rosewood":"#9f400f", "copper":"#e86423", "peach":"#ffc397", "chocolate":"#61300b", "bronze":"#c26718", "orange":"#ff8a00", "honey":"#ffbe6a", "caramel":"#aa7e4a", "gold":"#ffc11d", "brass":"#ffd76b", "beeswax":"#c4af22", "lemon":"#ffe900", "beige":"#fff8a8", "olive":"#707916", "fern":"#b4cd20", "tennis ball":"#e5ff00", "pistachio":"#e5ff9f", "forest":"#234d00", "green":"#64c900", "lime":"#adff69", "xanadu":"#c2ffaf", "grass":"#337744", "teal":"#009677", "robin egg":"#2deacf", "mist":"#a3ffe1", "ocean blue":"#1699bb", "cerulean":"#5bd5ff", "arctic":"#caf6ff", "lazuli":"#5050ff", "sky blue":"#80c0ff", "ghost white":"#eef3f6", "ink":"#30228c", "blueberry":"#6660ff", "glaucous":"#aec2ff", "magic":"#f3e9ff", "indigo":"#401187", "electric indigo":"#7f36df", "lavender indigo":"#b796ff", "glossy grape":"#7c6699", "grape":"#4b0078", "violet":"#8904d1", "psychic":"#bb6eff", "lavender":"#e0caff"};

var cn = [
  "black", "anubis", "mold", "machine",
  "galaxy", "raspberry", "grass", "glossy grape",
  "concrete", "smoke", "cream", "white",
  "wine", "purple", "magenta", null,
  "maroon", "rose", "orchid", "cherry blossom",
  "garnet", "cherry", "cerise", "rouge",
  "crimson", "red", "scarlet", "puce",
  null, "chestnut", "coral", "jovial",
  null, "rosewood", "copper", "peach",
  "chocolate", "bronze", "orange", "honey",
  null, "caramel", "gold", "brass",
  null, "beeswax", "lemon", "beige",
  "olive", "fern", "tennis ball", "pistachio",
  "forest", "green", "lime", "xanadu",
  null, "teal", "robin egg", "mist",
  null, "ocean blue", "cerulean", "arctic",
  null, "lazuli", "sky blue", "ghost white",
  "ink", "blueberry", "glaucous", null,
  "indigo", "electric indigo", "lavender indigo", "magic",
  "grape", "violet", "psychic", "lavender"
];

var palette = [
  ["concrete", "smoke", "cream", "white"],
  ["black", "galaxy", "anubis", "mold", "machine"],
  ["wine", "maroon", "garnet", "crimson", "chocolate", "olive", "forest", "ink", "indigo", "grape"],
  ["rosewood"],
  ["purple", "rose", "cherry", "red", "chestnut", "bronze", "beeswax", "fern", "green", "teal", "ocean blue", "lazuli", "blueberry", "electric indigo", "violet"],
  ["cerise", "scarlet", "copper", "orange", "gold", "lemon", "tennis ball", "lime", "robin egg", "cerulean", "sky blue", "glaucous", "lavender indigo", "psychic"],
  ["magenta", "orchid", "coral"],
  ["cherry blossom", "rouge", "jovial", "peach", "honey", "brass", "beige", "pistachio", "xanadu", "mist", "arctic", "ghost white", "magic", "lavender"],
  ["raspberry", "puce", "caramel", "grass", "glossy grape"]
];

var colorsets = {};
var pictures = {};
var swatches = {};
function loadcolors(file){
  var xhr = new XMLHttpRequest();
  var isTainted = true;
  xhr.overrideMimeType("application/json");
  xhr.open('GET', file, true);
  xhr.setRequestHeader("Cache-Control", "no-cache, no-store, max-age=0")
  xhr.send();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status !== 404 && xhr.responseText) {
        if (file == "colorsets.json"){
          colorsets = JSON.parse(xhr.responseText);
        } else if (file == "pictures.json"){
          pictures = JSON.parse(xhr.responseText);
        } else if (file == "swatches.json") {
          swatches = JSON.parse(xhr.responseText);
        } else {
          toys = JSON.parse(xhr.responseText);
        }
      } else if (xhr.responseText){
        local_tooltip.style.display = "inline-block";
        local_tooltip.innerHTML = "⚠";
        local_tooltip.setAttribute("data-tooltip", file + " not found! (404 error)");
      } else {
        local_tooltip.style.display = "inline-block";
        local_tooltip.innerHTML = "⚠";
        local_tooltip.setAttribute("data-tooltip", "couldn't access " + file + "! (non-404 error)");
      }
    }
    isTainted = false;
  }
}

var realwidth = function(t){
  if(!t.naturalWidth) {
    return setTimeout(realwidth, 10, t);
  }
  t.style.width = "initial";
}

function lazyload(){
  var imageObserver = new IntersectionObserver(function(entries, observer) {
    entries.forEach(function(e) {
      if (e.isIntersecting) {
        let t = e.target;
        t.src = t.dataset.src;
        setTimeout(realwidth, 10, t);
        imageObserver.unobserve(t);
      }
    });
  });

  var lazyloadImages = document.querySelectorAll(".lazy");
  lazyloadImages.forEach(function(e) {
    e.classList.remove("lazy");
    e.style.height = "200px";
    e.style.width = "300px";
    imageObserver.observe(e);
  });
}

function makedots(cs, pos){
  var gradientbg = "";
  var newbar = [];

  if (cs.length == 1) {
    return "<div style='display:inline-block; padding:0px 3px; cursor:pointer; line-height:1.1;' data-color='droponly' data-tooltip='drop only'>✨</div>";
  }

  while (pos < cs.length) {
    var r1 = cs[pos];
    var r2 = cs[pos+1];
    var r3 = cs[pos+2];
    var bc = "rgba(0, 0, 0, 0.5)";
    var bt = r2;
    var tr = "";
    var st = "";
    if (r2%4 == 2){
      tr = "semi-translucent ";
    } else if (r2%4 == 3){
      tr = "translucent ";
    }
    if (r2 > 7) {
      tr += "metallic ";
      st = "✨";
      bt -= 8;
    } else if (r2 > 3) {
      tr += "pearlescent ";
      st = "💫";
      bt -= 4;
    }
    if (r1 == "black" || r1 == "galaxy") {
      bc = "#556";
      bt += 1;
    }
    if (r3 == 2){
      if (creative && creative.classList == "previous") {
        pos += 3;
        continue;
      }
      newbar[newbar.length-1][0].push(fc[r1]);
    } else {
      newbar.push([[fc[r1]], ""]);
    }
    newbar[newbar.length-1][1] += "<div style='display:inline-block; padding:0px 3px; cursor:pointer;' data-color='" + r1 + "' data-tooltip='" + tr + r1 + "'><div class='dot' style='pointer-events:none; height:" + (12-2*bt) + "px; width:" + (12-2*bt) + "px; border:" + bt + "px solid " + bc + "; background: transparent; color:rgba(255, 255, 255, 0.5); font-size:15px; filter: grayscale(100%);'>" + st + "</div></div>";
    pos += 3;
  }

  for (const color of newbar) {
    const long = color[0].length*18-18;
    let fcc = ", " + color[0][0] + " 6px";
    for (const [n, o] of color[0].entries()) {
      fcc += ", " + o + " " + (6+18*n) + "px";
    }
    fcc += ", " + color[0][color[0].length-1];
    gradientbg += "<div style='display:inline-block;'><div style='position:absolute;'>" + color[1] + "</div><div style='padding:0px 3px;'><div class='dot' style='pointer-events:none; height: 12px; width:" + (12 + long) + "px; border: none; background: linear-gradient(90deg" + fcc + ");'></div></div></div>";
  }
  return gradientbg;
}

function galleryset2(){
  var buffer = "";
  for (const gset of galleryset[1]) {
    buffer += "<div class='frame'><a class='fileThumb' href='" + gset + "'><img class='lazy' data-src='" + gset + "'></a></div>";
  }
  gallery.insertAdjacentHTML("beforeend", buffer);
  lazyload();
  more.style.display = "none"; 
}

function cssel(){
  const links = document.querySelectorAll(".colorset");
  const orig_colorset = colorset ? colorset.replace(/(^cs\s|\smas$)/g, '') : false;
  for (const link of links) {
    if (colorset && link.innerHTML.toLowerCase().replace(/(^cs\s|'|\smas$)/g, '') == orig_colorset) {
      link.classList.add("colorsel");
    } else {
      link.classList.remove("colorsel");
    }
  }
}

var galleryset = [[], []];
function makegallery(){
  if (!editor.innerHTML.startsWith("Connect to Bad Dragon")) {
    echo("Replace this text field with 'Connect to Bad Dragon' and release me from liability.\nThis might strain Bad Dragon server/your computer and I'll not be held responsible for that.\n")
    return;
  }

  more.style.display = "none";
  var buffer = "";
  var bookmarks = editor.innerHTML.replace(/Bad Dragon\//g, "https://da6npmvqm28oa.cloudfront.net/inventory-toy-services/").replace(/\<br\>/g, "\n").split("\n").filter(function(e){return (e&&!e.startsWith("SHAME ")&&(e.toLowerCase().endsWith(".jpg")||e.toLowerCase().endsWith(".png")))});

  for (const bookmark of bookmarks) {
    buffer += "<div class='frame'><a class='fileThumb' href='" + bookmark + "'><img class='lazy' data-src='" + bookmark + "'></a></div>";
  }

  for (const custom_twins of pictures["custom twins"]){
    var featured = false;
    var k = Object.keys(custom_twins)[0];
    var colortip = "";

    for (const cs of custom_twins[k]) {
      if (cs[0].toLowerCase().replace(/'/g, "") == colorset) {
        featured = true;
      }
      colortip += "&gt; <span class='colorset'>" + cs[0] + "</span>" + makedots(cs, 1) + "<br>";
    }

    if(featured){
      buffer += "<div class='frame'><a class='fileThumb' href='" + k + "'><img class='lazy' data-src='" + k + "'></a><div style='display:inline-block; vertical-align:top;'>" + colortip + "</div></div>"
    }
  }

  galleryset = [[], []];
  for (const [i, picture] of pictures[colorset].entries()){
    if (i < 12){
      galleryset[0].push(picture);
    } else {
      galleryset[1].push(picture);
    }
  }

  for (const gset of galleryset[0]){
    buffer += "<div class='frame'><a class='fileThumb' href='" + gset + "'><img class='lazy' data-src='" + gset + "'></a></div>"
  }

  gallery.innerHTML = buffer;

  cssel();

  lazyload();

  if (pictures[colorset].length>11){
    more.innerHTML = "Load " + (pictures[colorset].length-12) + " more pictures";
    more.style.display = "inline-block"; 
  }
}

function makelink(cs){
  let c = colorsets[cs];
  let tt = "";
  if (c[0]) {
    if (Array.isArray(c[0])) {
      tt += [c[0][0], ...c[0].slice(2)].join("/");
      if (c[0][1]) {
        tt += ' ꍯ ' + c[0][1];
      }
    } else {
      tt += c[0];
    }
  }
  let lowkey = cs.toLowerCase();
  if (lowkey in swatches) {
    if (Array.isArray(swatches[lowkey])) {
      for (const ent of swatches[lowkey]) {
        tt += "<br>" + ent["description"] + "<br><img style='vertical-align:middle;' src='" + ent["swatchImage"] + "'>";
      }
    } else {
      tt += "<br>" + swatches[lowkey]["description"] + "<br><img style='vertical-align:middle;' src='" + swatches[lowkey]["swatchImage"] + "'>";
    }
    if (lowkey + " mas" in swatches) {
      const swatchmas = swatches[lowkey + " mas"]
      if (swatchmas["description"].toLowerCase().replace(/\./g, "") != swatches[lowkey]["description"].toLowerCase().replace(/\./g, "")) {
        tt += "<br> ꍯ " + swatchmas["description"] + "<br>";
      } else {
        tt += " ꍯ ";
      }
      tt += "<img src='" + swatchmas["swatchImage"] + "'>";
    } else if ("cs " + lowkey in swatches) {
      tt += " ꍯ Swap available";
    } else if (Array.isArray(c[0]) && c[0][1]) {
      tt += " ꍯ Swap N/A or naming issue";
    }
  }
  let s = document.createElement("span");
  s.classList.add("colorset");
  if (Array.isArray(c[0])) {
    s.dataset.colorTheme = c[0][0];
    if (c[0][1]) {
      s.dataset.colorTheme2 = c[0][1];
    }
    if (c[0].length > 2) {
      s.dataset.colorTheme3 = c[0][2];
    }
    if (c[0].length > 3) {
      s.dataset.colorTheme4 = c[0][3];
    }
    if (c[0].length > 4) {
      s.dataset.colorTheme5 = c[0][4];
    }
  } else {
    s.dataset.colorTheme = c[0];
  }
  s.dataset.tooltip = tt;
  s.innerHTML = cs;
  return s.outerHTML;
}

function makeDIV(id, t, tooltip, pointer=false) {
  const d = document.createElement("DIV");
  d.classList = "next";
  d.id = id;
  d.dataset.tooltip = tooltip;
  d.innerHTML = t;

  if (pointer) {
    d.style.cursor = "pointer";
  }

  return d;
};

function makeUL(array) {
  const list = document.createElement('ul');
  for (const i of Array(array.length).keys()) {
    const item = document.createElement('li');
    item.appendChild(document.createTextNode(array[i]));
    list.appendChild(item);
  }
  return list;
}

function FFdown(e) {
  if (link && e.target.tagName != "A") {
    link.classList.remove("blink");
    gallery_tooltip.style.display = "none";
  }

  if (e.target.getAttribute("id") == "translucents") {
    if (translucents.classList == "next") {
      translucents.classList = "previous";
    } else {
      translucents.classList = "next";
    }
  } else if (e.target.getAttribute("id") == "creative") {
    if (creative.classList == "next") {
      creative.classList = "previous";
    } else {
      creative.classList = "next";
    }
  } else if (e.target.getAttribute("id") == "odnary") {
    colorset = odnary.getAttribute("data-colorset");
    makegallery();
  } else if (e.target.getAttribute("id") == "replace") {
    more.style.display = "none"; 
    var buffer = "";

    galleryset = [[], []];
    var lines = editor.innerHTML.replace(/Bad Dragon\//g, "https://da6npmvqm28oa.cloudfront.net/inventory-toy-services/").replace(/\<br\>/g, "\n").split("\n");
    var bookmarks = lines.filter((e) => {return (e&&!e.startsWith("SHAME ")&&(e.toLowerCase().endsWith(".jpg")||e.toLowerCase().endsWith(".png")))});
    for (const bookmark of bookmarks) {
      galleryset[0].push(bookmark);
    }

    for (const gset of galleryset[0]) {
      buffer += "<div class='frame'><a class='fileThumb' href='" + gset + "'><img class='lazy' data-src='" + gset + "'></a></div>";
    }
    rainbow = [];
    for (const line of lines) {
      if (line in colorsets && colorsets[line] != true){
        let cs = colorsets[line];
        rainbowfade = false;
        for (var o=1; o<cs.length; o+=3) {
          rainbow.push(cs[o], 0, rainbowfade?2:0);
          rainbowfade = true;
          if (rainbow.length > 408*3) {
            rainbow = rainbow.slice(3);
            rainbow[2] = 0;
          }
        }
        rainbowfade = false;
      } else if (line == "palette") {
        for (const p of palette) {
          rainbowfade = false;
          for (const palett of p) {
            rainbow.push(palett, 0, rainbowfade?2:0);
            rainbowfade = true;
            if (rainbow.length > 408*3) {
              rainbow = rainbow.slice(3);
              rainbow[2] = 0;
            }
          }
          rainbowfade = false;
        }
      } else if (line in fc) {
        rainbow.push(line, 0, rainbowfade?2:0);
        rainbowfade = true;
        if (rainbow.length>408*3) {
          rainbow = rainbow.slice(3);
          rainbow[2] = 0;
        }
      } else {
        rainbowfade = false;
      }
    }
    rainbowfade = false;
    pukefest.innerHTML = makedots(rainbow, 0);

    const b = document.createElement("button");
    b.innerHTML = "ꍯ";
    b.classList = "dark";
    b.id = "fadeends";
    b.style.display = "none";
    b.addEventListener('click', () => {
      rainbowfade = false;
      fadeends.display = 'none';
    });
    b.setAttribute("data-tooltip", "Fade ends");
    pukefest.appendChild(b);

    gallery.innerHTML = buffer;
    colorset = undefined;
    cssel();
    lazyload();
  } else if (e.target.getAttribute("id") == "gallerysave") {
    if (gallerysave.classList == "previous") {
      return;
    }

    let expires = new Date(Date.now() + 365 * 864e5).toUTCString();
    var h = editor.innerHTML.replace(/<br>/g, "\n").replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/");
    document.cookie = "gallerysave=" + encodeURIComponent(h) + "; expires=" + expires + "; path=/; SameSite=Strict;";
    //no expiry would allow the cookie to be automatically deleted upon browser exit.
    gallerysave.classList = "previous";
    gallerysave.innerHTML = "Save completed";
  } else if (e.target.getAttribute("id") == "cs") {
    colorset = cs.getAttribute("data-colorset");
    makegallery();
  } else if (e.target.getAttribute("id") == "mas") {
    colorset = mas.getAttribute("data-colorset");
    makegallery();
  } else if (e.target.getAttribute("id") == "more") {
    galleryset2();
  } else if (e.target.classList.contains("colorset")) {
    link = e.target;
    link.classList.add("blink");
    odnary.style.display = "none";
    cs.style.display = "none";
    mas.style.display = "none";
    var t = link.innerHTML.toLowerCase().replace(/'/g, "");
    if (Object.keys(pictures).includes(t)) {
      odnary.style.display = "inline-block";
      odnary.setAttribute("data-colorset", t);
    }
    if (Object.keys(pictures).includes("cs " + t)) {
      cs.style.display = "inline-block";
      cs.setAttribute("data-colorset", "cs " + t);
    }
    if (Object.keys(pictures).includes(t + " mas")) {
      mas.style.display = "inline-block";
      mas.setAttribute("data-colorset", t + " mas");
    }
    const listtoys = [];
    const ct = link.dataset.colorTheme;
    if (ct) {
      checkinv.style.display = "inline-block";
      checkinv.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct;
    } else {
      checkinv.style.display = "none";
    }
    if (toys[ct]) {
      listtoys.push(...toys[ct]);
    } else {listtoys.push("Unknown caller")}
    const ct3 = link.dataset.colorTheme3;
    if (ct3) {
      checkinv_2.style.display = "inline-block";
      checkinv_2.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct3;
      if (toys[ct3]) {
        listtoys.push(...toys[ct3].map((x) => {return "2 " + x}));
      } else {listtoys.push("2 Unknown caller")}
    } else {
      checkinv_2.style.display = "none";
    }
    const ct4 = link.dataset.colorTheme4;
    if (ct4) {
      checkinv_3.style.display = "inline-block";
      checkinv_3.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct4;
      if (toys[ct4]) {
        listtoys.push(...toys[ct4].map((x) => {return "3 " + x}));
      } else {listtoys.push("3 Unknown caller")}
    } else {
      checkinv_3.style.display = "none";
    }
    const ct5 = link.dataset.colorTheme5;
    if (ct5) {
      checkinv_4.style.display = "inline-block";
      checkinv_4.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct5;
      if (toys[ct5]) {
        listtoys.push(...toys[ct5].map((x) => {return "4 " + x}));
      } else {listtoys.push("4 Unknown caller")}
    } else {
      checkinv_4.style.display = "none";
    }

    const ct2 = link.dataset.colorTheme2;
    if (ct2) {
      checkinv_mas.style.display = "inline-block";
      checkinv_mas.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct2;
      if (toys[ct2]) {
        listtoys.push(...toys[ct2].map((x) => {return "ꍯ " + x}));
      } else {listtoys.push("ꍯ Unknown caller")}
    } else {
      checkinv_mas.style.display = "none";
    }
    const UL = makeUL(listtoys);
    const rows = listtoys.length >= 20 ? 20 : listtoys.length;
    UL.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    checkcom.setAttribute("data-tooltip", UL.outerHTML);
    where = link.getBoundingClientRect();
    gallery_tooltip.style.left = (window.scrollX + where.left -2) + "px";
    gallery_tooltip.style.top = (window.scrollY + where.top -28) + "px";
    gallery_tooltip.style.display = "inline-block";
  } else if (e.target.hasAttribute("data-schande")) {
    var t = e.target;
    var a = t.parentNode;
    var d = document.createElement("div");
    a.appendChild(d);
    t.addEventListener('touchmove', (e) => {e.preventDefault()});

    if (t.classList.contains("save")) {
      if (isTouch) {
        d.classList.add("right");
        const [x, y] = [e.pageX, e.pageY];
        const listener = (z) => {
          if (-20 < (y - z.pageY) && (y - z.pageY) < 20 && (z.pageX - x) > 50) {
            d.classList.remove("right");
            echo(t.getAttribute("data-schande"));
            t.removeEventListener('touchend', listener);
            t.removeAttribute("busy");
            edit();
          }
        };

        if (!t.hasAttribute("busy")) {
          t.addEventListener('touchend', listener);
          t.setAttribute("busy", true);
        }

        t.addEventListener('mouseleave', () => {
          d.classList.remove("right");
        });
      } else {
        const listener = () => {
          echo(t.getAttribute("data-schande"));
          t.removeEventListener("mouseup", listener);
          edit();
        }
        t.addEventListener("mouseup", listener);
      }
    } else {
      if (isTouch) {
        d.classList.add("left");
        const [x, y] = [e.pageX, e.pageY];
        const listener = (z) => {
          if (-20 < (y - z.pageY) && (y - z.pageY) < 20 && (x - z.pageX) > 50) {
            d.classList.remove("left");
            echo("SHAME " + t.getAttribute("data-schande"));
            t.removeEventListener('touchend', listener);
            t.removeAttribute("busy");
            edit();
          }
        };

        if (!t.hasAttribute("busy")) {
          t.addEventListener('touchend', listener);
          t.setAttribute("busy", true);
        }

        t.addEventListener('mouseleave', () => {
          d.classList.remove("left");
        });
      } else {
        const listener = () => {
          echo("SHAME " + t.getAttribute("data-schande"));
          t.removeEventListener("mouseup", listener);
          edit();
        }
        t.addEventListener("mouseup", listener);
      }
    }
  } else if (e.target.getAttribute("id") == "exotic") {
    const colorsels = [];
    for (const key of Object.keys(colorsets)) {
      const k = colorsets[key];
      let featured = false;
      if (10 < k.length) {
        featured = true;
      } else {
        let pos = 1;
        while (pos < k.length) {
          if (k[pos+2] > 1) {
            featured = true;
            break;
          }
          pos += 3;
        }
      }
      if (featured) {
        colorsels.push(key);
      }
    }
    let colortip = "";
    for (const cs of colorsels) {
      colortip += "&gt; " + makelink(cs) + makedots(colorsets[cs], 1) + "<br>";
    }
    colorlist.innerHTML = "<h3>Choose a color!</h3>" + colortip;
    cssel();
  } else if (e.target.getAttribute("id") == "droponly" || e.target.hasAttribute("data-color") && e.target.getAttribute("data-color") == "droponly") {
    if (isTouch && e.target.hasAttribute("data-color") && e.target.hasAttribute("data-tooltip")) {
      return;
    }

    let colortip = "";
    for (const css of Object.keys(colorsets)) {
      if (colorsets[css] == true || colorsets[css].length != 1) {
        continue;
      }
      colortip += "&gt; " + makelink(css) + makedots(colorsets[css], 1) + "<br>";
    }
    colorlist.innerHTML = "<h3>Drop only color sets</h3>" + colortip;
    cssel();
  } else if (e.target.getAttribute("id") == "viewall") {
    let colortip = "";
    for (const css of Object.keys(colorsets)) {
      if (colorsets[css] == true) {
        colortip += css + "<br>";
        continue;
      }
      colortip += "&gt; " + makelink(css) + makedots(colorsets[css], 1) + "<br>";
    }
    colorlist.innerHTML = "<h3>Choose a color!</h3>" + colortip;
    cssel();
  } else if (e.target.getAttribute("id") == "numbered") {
    let colortip = "";
    const presorted = {};

    for (const css of Object.keys(colorsets)) {
      if (colorsets[css] == true) {
        continue;
      }

      id = colorsets[css][0];
      if (Array.isArray(id)) {
        for (const idp of id) {
          if (idp && !presorted[idp]) {
            presorted[idp] = css;
          }
        }
      } else if (id) {
        presorted[id] = css;
      }
    }

    let index = 1;
    for (const id of Object.keys(presorted)) {
      while (id > index) {
        colortip += index.toString().padStart(4, ' ') + "<br>";
        index++;
      }
      index++;

      const css = presorted[id];
      colortip += id.padStart(4, ' ') + " " + makelink(css) + makedots(colorsets[css], 1) + "<br>";
    }
    colorlist.innerHTML = "<h3>Choose a color!</h3>" + colortip;
    cssel();
  } else if (e.target.hasAttribute("data-color")) {
    if (isTouch && e.target.hasAttribute("data-tooltip")) {
      return;
    }
    const t = e.target.getAttribute("data-color");

    if (!t) {
      colorlist.innerHTML = "<h3>Choose a color!</h3>";
      return;
    }

    rainbow.push(t, 0, rainbowfade?2:0);
    rainbowfade = true;

    if (rainbow.length > 408*3) {
      rainbow = rainbow.slice(3);
      rainbow[2] = 0;
    }

    pukefest.innerHTML = makedots(rainbow, 0);
    const b = document.createElement("button");
    b.innerHTML = "ꍯ";
    b.classList = "dark";
    b.id = "fadeends";
    b.addEventListener('click', () => {
      rainbowfade = false;
      fadeends.style.display = 'none';
    });
    b.setAttribute("data-tooltip", "Fade ends");
    pukefest.appendChild(b);

    const colorsels = [];
    for (const key of Object.keys(colorsets)) {
      const k = colorsets[key];
      let featured = false;
      let pos = 1;
      while (pos < k.length) {
        if (k[pos] == t) {
          if (translucents.classList == "previous"){
            if (k[pos+1] > 1) {
              featured = true;
            }
          } else {
            featured = true;
          }
          if (featured && creative.classList == "previous") {
            if (k[pos+2] > 0) {
              featured = false;
            }
          }
        }
        pos += 3;
      }
      if (featured) {
        colorsels.push(key);
      }
    }
    let colortip = "";
    for (const cs of colorsels) {
      colortip += "&gt; " + makelink(cs) + makedots(colorsets[cs], 1) + "<br>";
    }
    colorlist.innerHTML = "<h3>Color sets using " + t + "-like silicone</h3>" + colortip;
    cssel();
  }
}

var link = false;
var cur = 0;
var downmove = false;
var busymoving, busypicker, busytyping;
var updatesel = false;
var updatelen = 0;
function FFup() {
  let sel = editor.ownerDocument.defaultView.getSelection();
  let len = sel.toString().length;
  let pos = sel.getRangeAt(0);
  if(link && link.classList.contains("hyperlink")){
    link.classList.remove("blink");
    cursor_tooltip.style.display = "none";
  }
  link = sel.anchorNode.parentNode;
  let ans = false;
  if(link.classList.contains("hyperlink")){
    link.classList.add("blink");
    where = link.getBoundingClientRect();
    cursor_tooltip.style.left = (window.scrollX + where.left + 6) + "px";
    cursor_tooltip.style.top = (window.scrollY + where.top + (where.top < 60?30:-30)) + "px";
    cursor_tooltip.innerHTML = "<a href='" + link.innerHTML + "' target='_blank' class='next' style='text-decoration:none; font-size:12px; font-family:sans-serif;'>Open</a>";
    cursor_tooltip.style.display = "inline-block";
  } else if (len > 0 && len < 256){
    if (!updatesel){
      updatesel = window.setInterval(function () {
        let sel = editor.ownerDocument.defaultView.getSelection();
        let len = sel.toString().length;
        if (len !== updatelen){
          updatelen = len;
          FFup()
        }
      }, 500);
    }
    try {
      ans = new Function('return ' + sel.toString().replace(/(\r|\n)/g, ""))().toFixed(10)*1;
    } catch {
      cursor_tooltip.style.display = "none"
    }
  } else {
    window.clearInterval(updatesel);
    updatesel = false;
    cursor_tooltip.style.display = "none";
  }
  let preCaretRange = pos.cloneRange();
  if(ans !== false){
    where = preCaretRange.getBoundingClientRect()
    cursor_tooltip.style.left = (window.scrollX + where.left) + "px";
    cursor_tooltip.style.top = (window.scrollY + where.top + 36) + "px";
    cursor_tooltip.innerHTML = "<span class='tangerine' style='font-size:14px;'>" + ans + "</span>";
    cursor_tooltip.style.display = "inline-block";
  };
  preCaretRange.selectNodeContents(editor);
  preCaretRange.setEnd(pos.endContainer, pos.endOffset);
  cur = preCaretRange.toString().length;
  calc.placeholder = "Ln:" + editor.textContent.substr(0, cur).split("\n").length + " Pos:" + cur;
}

function plaintext(elem, e) {
  e.preventDefault();
  var text = e.clipboardData.getData('text/plain').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  document.execCommand('insertHTML', false, text);
}

function echo(B, b) {
  if (!b) B = "\n" + B
  if (b) B = " " + B
  editor.innerHTML += B;
}

function edit(){
  let sel = editor.ownerDocument.defaultView.getSelection();
  if(sel.rangeCount){
    let pos = sel.getRangeAt(0);
    let preCaretRange = pos.cloneRange();
    let where = preCaretRange.getBoundingClientRect()
    cursor_focus.style.left = (window.scrollX + where.left - 100) + "px";
    cursor_focus.style.top = (window.scrollY + where.top - 200) + "px";
    if(cursor_focus.offsetTop+200 < window.pageYOffset || cursor_focus.offsetTop+200 > window.pageYOffset+window.innerHeight || cursor_focus.offsetLeft+100 < window.pageXOffset || cursor_focus.offsetLeft+100 > window.pageXOffset+window.innerWidth){
      cursor_focus.scrollIntoView({top: 0, behavior: "smooth", inline:"start"})
    }
  }

  let h = editor.innerHTML.replace(/<br>/g, "\n").replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/")
  let n = encodeURIComponent(h).length;
  gallerysave.innerHTML = "Save " + n + "/4085"
  if (4085 < n){
    gallerysave.classList = "previous";
  } else {
    gallerysave.classList = "next";
  }
}

var Expand = function(c, t) {
  if(!c.naturalWidth) {
    return setTimeout(Expand, 10, c, t);
  }
  c.style.maxWidth = "100%";
  c.style.display = "";
  t.style.display = "none";
  t.style.opacity = "";
};

var FFclick = function(e) {
  var t = e.target;
  var a = t.parentNode;
  if (a.classList != undefined && a.classList.contains("fileThumb")) {
    e.preventDefault();
    if(t.hasAttribute("data-src")) {
      var c = document.createElement("img");
      c.setAttribute("src", a.getAttribute("href"));
      c.style.display = "none";
      a.appendChild(c);
      t.style.opacity = "0.75";
      setTimeout(Expand, 10, c, t);
    } else {
      a.firstChild.style.display = "";
      a.removeChild(t);
      outbound()
      a.offsetTop < window.pageYOffset && a.scrollIntoView({block: "start", behavior: "smooth"});
    }
  }
};

var outbound;
var FFover = function(e) {
  var t = e.target;
  var a = t.parentNode;
  if (a.classList != undefined && a.classList.contains("fileThumb") && !a.parentNode.hasAttribute("busy")) {
    a = a.parentNode;
    var d = document.createElement("div");
    d.innerHTML = "<div class='schande save'>Save</div><div class='schande' style='left:48px;'>Schande!</div>";
    a.appendChild(d);
    listener = (z) => {
      z.target.style.opacity = 1;
      if (z.target.classList.contains("schande")) {
        z.target.setAttribute("data-schande", (t.getAttribute("data-src")?t.getAttribute("data-src"):t.getAttribute("src")).replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/"))
      }
      z.target.removeEventListener("mouseover", listener);
      let left = () => {
        z.target.style.opacity = 0.5;
        z.target.removeEventListener("mouseleave", left);
      }
      z.target.addEventListener("mouseleave", left);
    }
    d.addEventListener("mouseover", listener);
    outbound = () => {
      setTimeout(function(){
        a.removeChild(d);
      }, 1)
      a.removeAttribute("busy")
      a.removeEventListener("mouseleave", outbound);
    }
    a.setAttribute("busy", true)
    a.addEventListener("mouseleave", outbound);
  }
}

var FFmove = function(e) {
  var t = e.target;
  if (t.hasAttribute("data-tooltip")) {
    tooltip.style.left = (e.pageX + 10) + "px";
    tooltip.style.top = (e.pageY + 10) + "px";
    tooltip.style.display = "inline-block";
    tooltip.innerHTML = t.getAttribute("data-tooltip");
    if (t.classList == "tangerine"){
      let left = () => {
        t.classList = "tangerine"
      }
      t.classList = "brown"
      t.addEventListener("mouseleave", left)
    }
  } else {
    tooltip.style.display = "none";
  }
}

var link, isTouch, gallerylist, creative, colorset;
var rainbow = [];
var rainbowfade = false;
var fadesample = makedots(["sky blue", 0, 0, "copper", 0, 2, "chestnut", 0, 2], 0);
var dotsample = 'sky blue (' + makedots(["sky blue", 0, 0], 0) + ') copper (' + makedots(["copper", 0, 0], 0) + ') then chestnut (' + makedots(["chestnut", 0, 0], 0) + ')';
window.onload = () => {
  document.body.innerHTML = `<div id="cursor_focus"></div><div class="cursor_tooltip" id="cursor_tooltip" style="transition: left .5s linear;"></div><div class="dark close_button cursor_tooltip" id="tooltip"></div>

<div style="position:absolute; display:none; z-index:1;" id="gallery_tooltip"><div class="next" id="odnary" style="cursor:pointer;">Gallery</div><a class="next" href="" target="_blank" id="checkinv">🧺</a><a class="next" href="" target="_blank" id="checkinv_2">2🧺</a><a class="next" href="" target="_blank" id="checkinv_3">3🧺</a><a class="next" href="" target="_blank" id="checkinv_4">4🧺</a><div class="next" id="mas" style="cursor:pointer;">Mas</div><div class="next" id="cs" style="cursor:pointer;">Swaps</div><a class="next" href="" target="_blank" id="checkinv_mas">ꍯ🧺</a><span class="tangerine" id="checkcom" style="padding:4px;" data-tooltip="">🧸</span></div>

<div id="toolbar"></div>
<div></div>

<div style="display:inline-block; position:relative; vertical-align:top; display:flex;">
<div id="colortable" style="vertical-align:top; display:inline-block; position:relative; color:#000; min-width:316px; max-width:316px;"></div>
<div id="minimap" style="vertical-align:top; display:none; position:relative; color:#000; min-width:80px; max-width:80px;"></div>
<div id="colorlist" style="display:inline-block; vertical-align:top; white-space:pre; margin-bottom:96px;"></div>
<div style="vertical-align:top;">

<div class="stdout" id="stdout" style="padding:0;"><div style="padding:4px 4px 0px 4px;">🦦 -(Bookmarked pictures) <div class="next" id="replace" style="cursor:pointer;">Replace gallery</div><div class="previous" id="gallerysave" style="cursor:pointer;" data-tooltip="Save text field as cookie for next page visit">Save</div><input id="calc" class="next" style="width:100px;" type="text" placeholder="Calculator"></div><div class="editor" id="editable" style="display:inline-block;" contenteditable="plaintext-only" spellcheck=false><br></div><div class="editor" id="editable2" style="display:none;" contenteditable="plaintext-only" spellcheck=false><br></div></div>
<div></div>
<div id="gallery" style="display:inline-block;"></div>
<div></div>
<div class="next" id="more" style="display:none; border:16px solid transparent; border-bottom:96px solid transparent; background-clip: padding-box;"></div>
</div>
</div>`;

  const toolbar = document.getElementById("toolbar");

  toolbar.appendChild(makeDIV("translucents", "Translucents", "Fetch color sets using semi-translucent or translucent of selected color"));

  toolbar.appendChild(makeDIV("creative", "Creative mode", "Unload color sets of selected color not possible for custom<br>&gt; Fade toy's midway and bottom colors<br>&gt; Silicones exclusive to wereables<br>&gt; Non-white highlights<br>&gt; Silicones covered by full cover highlights"));

  toolbar.appendChild(makeDIV("exotic", "Exotic sets", "View all color sets using fades or 4+ color marbles i.e. can't be altered", true));

  let d = document.createElement("SPAN");
  d.id = "droponly";
  d.innerHTML = "✨";
  d.dataset.tooltip = "View drop only color sets (unavailable for custom ordering)";
  // d.dataset.color = "drop only";
  d.style.cursor = "pointer";
  toolbar.appendChild(d);

  toolbar.appendChild(makeDIV("viewall", "View all", "Can't find a color set? Try this &amp; use your browser's find in page function!", true));

  toolbar.appendChild(makeDIV("numbered", "Numbered", "View color sets in order of color theme ID", true));

  d = document.createElement("DIV");
  d.classList = "tangerine";
  d.style.padding = "4px";
  d.dataset.tooltip = `• Choose several colors e.g. ${dotsample} for ${fadesample} fade bar to appear, as way to test as well as to anticipate for blend/smear issue.<br>• Write color name or color set name in text field of bookmarked pictures to manipulate fade bar.<br>&nbsp; ◦ <div class='next'>Replace gallery</div> to replace fade bar with written color names.<br>&nbsp; ◦ <div class='next'>Save</div> to save fade bar for next page visit.<br>&nbsp; ◦ Fade ends on non-color line.<br><br>Be mindful of translucent silicones<br>• Translucent silicones may overpower to each other especially darkened and/or pigmented ones if not become dull or muddled.<br>• Use fade bar for blend test of translucent silicones, they become pronounced of that.<br>• Solid silicones can create contours on translucent silicones or 3D depth behind translucent silicones.<br>Open <div class='next'>Gallery</div> for color set named <span class='colorset'>Arctic Ice</span>${makedots(['sky blue', 3, 0], 0)} from sky blue (${makedots(['sky blue', 0, 0], 0)}) color group for photo example of translucent silicone.`;
  d.innerHTML = ":?:";
  toolbar.appendChild(d);

  d = document.createElement("DIV");
  d.style.display = "inline-block";
  d.id = "pukefest";
  toolbar.appendChild(d);

  d = document.createElement("DIV");
  d.classList = "dark local_tooltip";
  d.id = "local_tooltip";
  toolbar.appendChild(d);

  loadcolors("colorsets.json");
  loadcolors("pictures.json");
  loadcolors("swatches.json");
  loadcolors("toys.json");

  for (const ccn of cn) {
    const d = document.createElement("DIV");
    d.classList = "cell";

    const m = document.createElement("DIV");
    m.classList = "mcell";

    if (ccn == null) {
      d.dataset.color = "";
    } else {
      const cc = fc[ccn];
      let cb = "#000000";

      // if (!cc || parseInt(cc.slice(1, 3), 16) < 144 && parseInt(cc.slice(3, 5), 16) < 144 && parseInt(cc.slice(5), 16) < 144) {
      //   cb = "rgba(255, 255, 255, 0.5)";
      // }

      d.style.verticalAlign = "top";
      d.style.background = cc;
      d.style.color = cb;
      d.dataset.color = ccn;
      d.innerHTML = ccn;

      m.style.background = cc;
    }

    colortable.appendChild(d);
    minimap.appendChild(m);
  }

  colorlist.innerHTML = "<h3>Choose a color!</h3>";
  document.addEventListener("click", FFclick);
  document.addEventListener("mousemove", FFmove);
  document.addEventListener("mouseover", FFover);
  //document.addEventListener("touchstart", FFdown);
  document.addEventListener("mousedown", FFdown);
  creative = document.getElementById("creative");
  editor = document.getElementById("editable");
  editdiff = document.getElementById("editable2");
  editor.addEventListener("mouseup", FFup);
  editor.onmousedown = () => {downmove = true};
  editor.onmouseup = () => {downmove = false};
  editor.onmousemove = () => {
    if(downmove == true){
      clearTimeout(busymoving)
      busymoving = setTimeout(FFup, 100)
    }
  };
  editor.setAttribute("oninput", "edit()");
  if(!editor.isContentEditable){
    editor.setAttribute("onpaste", "plaintext(this, event)");
    editor.setAttribute("contenteditable", "true");
    editdiff.setAttribute("onpaste", "plaintext(this, event)");
    editdiff.setAttribute("contenteditable", "true");
  }

  if('ontouchstart' in window){isTouch = true;};

  var fileThumb;
  document.addEventListener("dragstart", function(e) {
    if (e.target.className == 'fileThumb'){
      fileThumb = e.target;
    }
  }, false);

  editor.addEventListener("drop", function(e) {
    if(fileThumb){
      e.preventDefault();
      echo(fileThumb.childNodes[0].getAttribute("src").replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/"));
      edit();
      fileThumb = null;
    }
  }, false);

  const cookies = document.cookie.split(';');
  for (const cookie of cookies) {
    let c = cookie;

    while (c.charAt(0) == ' '){
      c = c.substring(1, c.length);
    };

    if (c.indexOf("gallerysave=") == 0){
      editor.innerHTML = decodeURIComponent(c.substring("gallerysave=".length, c.length));
    }
  }

  calc.addEventListener("keyup", (e) => {
    let c = calc.value;
    if (!c) {
      calc.style.backgroundColor = "#066";
    } else if (e.keyCode === 13) {
      try {
        calc.value = new Function('return ' + c)().toFixed(10)*1;
      } catch {
        if (c.startsWith("u")) {
          calc.value = deuni("\\" + c);
        }
      }
    } else {
      try {
        new Function('return ' + c)();
        calc.style.backgroundColor = "#066";
      } catch {
        if (c.startsWith("u") && (!c.slice(1) || Number('0x'+c.slice(1)))) {
          if (c.length == 5) {
            calc.style.backgroundColor = "#066";
          } else if (c.length > 5) {
            calc.style.backgroundColor = "#399";
          } else if (c.length < 5) {
            calc.style.backgroundColor = "#033";
          }
        } else {
          calc.style.backgroundColor = "#399";
        }
      }
    }
  });
}
</script></head><body class="exitmenu">1. Set up and run Schande.bat for its HTTP server from <a href="https://github.com/Rukario/Schande">https://github.com/Rukario/Schande</a>
2. Take me to Schande.bat, then launch <a href="http://127.0.0.1:8886/Color Gallery.html">http://127.0.0.1:8886/Color Gallery.html</a></body></html>
