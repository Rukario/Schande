<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="user-scalable=0">
<title>Color Gallery</title>
<style>
:root {
  color-scheme: light dark;

  --color-background: Canvas;
  --color-background: #10100c;

  --color-background: CanvasText;
  --color-foreground: #088;
}

body {
  caret-color: #ffbbff;
  font-family: courier;
  font-size: 14px;
  user-select: none;
  -webkit-text-size-adjust: none;
  -webkit-user-select: none;
}

::selection {
  background: rgba(255, 192, 255, 0.25);
}

[contenteditable]:focus, input:focus {
  outline: none;
}

.editor {
  padding: 8px 12px;
  width: calc(100% - 24px);
  min-height: 12px;
  line-height: 1.1;
  white-space: pre-wrap;
}

a {
  color: #ccbb77;
}

a:visited {
  color: #efdfa8;
}

img {
  vertical-align: top;
}

.fileThumb {
 scroll-margin-top: 250px;
}

h1, h2, h3, h4, h5, h6 {
  margin: 4px;
}

.colorset {
  color: #bfddc6;
  cursor: pointer;
}

.colorsel {
  background-color: #c60;
  color: #fc3;
  border: 1px solid #842;
  margin: -1px;
}

.hyperlink {
  color: #bfddc6;
  text-decoration: underline;
}

.tang {
  background-color: #620;
  color: #efd;
  border: 1px solid #842;
  margin: -1px;
}

.blink {animation: bl 1000ms linear infinite;}
@keyframes bl{0%{opacity:100%;} 50%{opacity:50%;} 100%{opacity:100%;}}

input[type="text"] {
  padding: 3px 11px; /*Firefox: padding:3px 11px 4px;*/
  width: 86px;
}

input[type="file"] {
  display: none;
}

input[type="color"] {
  width: 0;
  height: 0;
  padding: 0;
  margin: 0;
  border: 0;
  opacity: 0;
}

ul {
  display: inline-grid;
  grid-template-rows: repeat(20, 1fr);
  grid-auto-flow: column;
  grid-column-gap: 10px;
  list-style: none;
  padding: 0;
  margin: 0;
}

::placeholder {
  color: #3cb;
}

.cell {
  position: relative;
  display: inline-block;
  cursor: pointer;
  line-height: 1.1;
  background-color: #333;
  border: 2px solid #000;
  width: 75px;
  height: 44px;
}

.minicell {
  background-color: #333;
  border: 1px solid #000;
  width: 18px;
  height: 11px;
}

#colortable {
  vertical-align: top;
  display: inline-block;
  position: relative;
  color: #000;
  min-width: 316px;
  max-width: 316px;
  line-height: 0;
}

#colorlist {
  display: inline-block;
  vertical-align: top;
  white-space: pre;
  margin-bottom: 96px;
}

#minimap {
  vertical-align: top;
  display: none;
  position: relative;
  color: #000;
  min-width: 80px;
  max-width: 80px;
  line-height: 0;
}

#gallery_tooltip {
  position: absolute;
  display: none;
  z-index: 1;
}

#more {
  display: none;
  border: 16px solid transparent;
  border-bottom: 96px solid transparent;
  background-clip: padding-box;
}

#fadeends {
  line-height: 0;
}

.previous, .reverse, .inverse, .next, .tangerine, .brown {
  white-space: nowrap;
  font-family: sans-serif;
  font-size: 90%;
  position: relative;
  display: inline-block;
  border: 1px solid #033;
  border-radius: 0px;
  padding: 4px 11px;
  margin: 2px;
  line-height: 1.1;
}

.next {
  color: #6fe;
  background-color: #066;
}

.previous {
  color: #6fe;
  background-color: #399;
}

.reverse {
  background-color: #428;
  color: #d9f;
  border: 1px solid #214;
}

.inverse {
  background-color:#d9f;
  color:#428;
  border: 1px solid #214;
}

.tangerine {
  background-color: #c60;
  color: #fc3;
  border: 1px solid #842;
}

.brown {
  background-color: #620;
  color: #620;
  border: 1px solid #842;
}

.droponly {
  display: inline-block;
  padding: 0px 3px;
  cursor: pointer;
  line-height: 1.1;
}

#main {
  display: inline-block;
  position: relative;
  vertical-align: top;
  display: flex;
}

.dark {
  background-color: rgba(0, 0, 0, 0.5);
  color: #fff;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

.close_button {
  position: absolute;
  top:15px;
  right: 15px;
  cursor: pointer;
}

.cursor_tooltip {
  padding: 0px 8px;
  font-family: sans-serif;
  font-size: 90%;
  position: absolute;
  z-index: 2;
  left: 0px;
  top: 0px;
  right: initial;
  display: none;
  pointer-events: none;
}

#cursor_tooltip {
  transition: left .5s linear;
}

#cursor_focus {
  position: absolute;
  left: 0px;
  top: 0px;
  right: initial;
  pointer-events: none;
}

.frame {
  display: inline-block;
  vertical-align: top;
  position: relative;
}

.dot {
  height: 10px;
  width: 10px;
  background-color: #333;
  border-radius: 6px;
  display: inline-block;
}

.stdout {
  white-space: pre-wrap;
  color: #9b859d;
  background-color: #110c13;
  border: 2px solid #221926;
  display: inline-block;
  padding: 6px;
  min-height: 0px;
}

.schande {
  opacity: 0.5;
  position: absolute;
  top: 158px;
  text-align: center;
  line-height: 34px;
  height: 34px;
  cursor: pointer;
  min-width: 40px;
  border: 2px solid transparent;
  background-clip: padding-box;
  box-shadow: inset 0 0 0 2px #c44;
  padding: 2px;
  background-color: #602;
  color: #f45;

  &.save {
    box-shadow:inset 0 0 0 2px #367;
    background-color: #142434;
    color: #2a9;
  }
}

.spinner {
  position: absolute;
  border-top: 9px solid #6cc;
  height: 6px;
  width: 3px;
  top: 162px;
  left: 24px;
  pointer-events: none;
  animation-name: spin;
  animation-duration: 700ms;
  animation-timing-function: linear;
}

.left, .right {
  position: absolute;
  height: 5px;
  width: 5px;
  transform: rotate(45deg);
  top: 166px;
  pointer-events: none;
}

.left {
  border-bottom: 2px solid #f66;
  border-left: 2px solid #f66;
  transform: rotate(45deg);
  left: 86px;
}

.right {
  border-bottom: 2px solid #6cc;
  border-left: 2px solid #6cc;
  transform: rotate(225deg);
  left: 21px;
}

@keyframes spin {
  from {
    transform:rotate(0deg);
  }

  to {
    transform:rotate(360deg);
  }
}

.menu {
  background-color: #110c13;
  color: #9b859d;
}

.exitmenu {
  background-color: var(--color-background);
  color: var(--color-foreground);
}

</style>
<script>
var fc = {"black":"#000000", "anubis":"#292220", "mold":"#222922", "machine":"#202229", "concrete":"#666666", "smoke":"#999999", "cream":"#dcd6cc", "white":"#ffffff", "galaxy":"#111114", "wine":"#500040", "purple":"#992282", "magenta":"#ff33e2", "maroon":"#820045", "rose":"#d60159", "orchid":"#ff6c9b", "cherry blossom":"#ffc9e8", "raspberry":"#aa5c7b", "garnet":"#770017", "cherry":"#d9002b", "cerise":"#ff464e", "rouge":"#ffb9c0", "puce":"#aa7370", "crimson":"#771700", "red":"#c7291b", "scarlet":"#f35548", "chestnut":"#bd3f20", "coral":"#f1876a", "jovial":"#f7c3b3", "rosewood":"#9f400f", "copper":"#e86423", "peach":"#ffc397", "chocolate":"#61300b", "bronze":"#c26718", "orange":"#ff8a00", "honey":"#ffbe6a", "caramel":"#aa7e4a", "gold":"#ffc11d", "brass":"#ffd76b", "beeswax":"#c4af22", "lemon":"#ffe900", "beige":"#fff8a8", "olive":"#707916", "fern":"#b4cd20", "tennis ball":"#e5ff00", "pistachio":"#e5ff9f", "forest":"#234d00", "green":"#64c900", "lime":"#adff69", "xanadu":"#c2ffaf", "grass":"#337744", "teal":"#009677", "robin egg":"#2deacf", "mist":"#a3ffe1", "ocean blue":"#1699bb", "cerulean":"#5bd5ff", "arctic":"#caf6ff", "lazuli":"#5050ff", "sky blue":"#80c0ff", "ghost white":"#eef3f6", "ink":"#30228c", "blueberry":"#6660ff", "glaucous":"#aec2ff", "magic":"#f3e9ff", "indigo":"#401187", "electric indigo":"#7f36df", "lavender indigo":"#b796ff", "glossy grape":"#7c6699", "grape":"#4b0078", "violet":"#8904d1", "psychic":"#bb6eff", "lavender":"#e0caff"};

var cn = [
  "black", "anubis", "mold", "machine",
  "galaxy", "raspberry", "grass", "glossy grape",
  "concrete", "smoke", "cream", "white",
  "wine", "purple", "magenta", null,
  "maroon", "rose", "orchid", "cherry blossom",
  "garnet", "cherry", "cerise", "rouge",
  "crimson", "red", "scarlet", "puce",
  null, "chestnut", "coral", "jovial",
  null, "rosewood", "copper", "peach",
  "chocolate", "bronze", "orange", "honey",
  null, "caramel", "gold", "brass",
  null, "beeswax", "lemon", "beige",
  "olive", "fern", "tennis ball", "pistachio",
  "forest", "green", "lime", "xanadu",
  null, "teal", "robin egg", "mist",
  null, "ocean blue", "cerulean", "arctic",
  null, "lazuli", "sky blue", "ghost white",
  "ink", "blueberry", "glaucous", null,
  "indigo", "electric indigo", "lavender indigo", "magic",
  "grape", "violet", "psychic", "lavender"
];

var palette = [
  ["concrete", "smoke", "cream", "white"],
  ["black", "galaxy", "anubis", "mold", "machine"],
  ["wine", "maroon", "garnet", "crimson", "chocolate", "olive", "forest", "ink", "indigo", "grape"],
  ["rosewood"],
  ["purple", "rose", "cherry", "red", "chestnut", "bronze", "beeswax", "fern", "green", "teal", "ocean blue", "lazuli", "blueberry", "electric indigo", "violet"],
  ["cerise", "scarlet", "copper", "orange", "gold", "lemon", "tennis ball", "lime", "robin egg", "cerulean", "sky blue", "glaucous", "lavender indigo", "psychic"],
  ["magenta", "orchid", "coral"],
  ["cherry blossom", "rouge", "jovial", "peach", "honey", "brass", "beige", "pistachio", "xanadu", "mist", "arctic", "ghost white", "magic", "lavender"],
  ["raspberry", "puce", "caramel", "grass", "glossy grape"]
];

var colorsets = {};
var pictures = {};
var swatches = {};
function loadcolors(file) {
  var xhr = new XMLHttpRequest();
  var isTainted = true;
  xhr.overrideMimeType("application/json");
  xhr.open('GET', file, true);
  xhr.setRequestHeader("Cache-Control", "no-cache, no-store, max-age=0")
  xhr.send();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status !== 404 && xhr.responseText) {
        if (file == "colorsets.json"){
          colorsets = JSON.parse(xhr.responseText);
        } else if (file == "pictures.json"){
          pictures = JSON.parse(xhr.responseText);
        } else if (file == "swatches.json") {
          swatches = JSON.parse(xhr.responseText);
        } else {
          toys = JSON.parse(xhr.responseText);
        }
      } else if (xhr.responseText){
        local_tooltip.style.display = "inline-block";
        local_tooltip.innerHTML = "⚠";
        local_tooltip.dataset.tooltip = file + " not found! (404 error)";
      } else {
        local_tooltip.style.display = "inline-block";
        local_tooltip.innerHTML = "⚠";
        local_tooltip.dataset.tooltip = "couldn't access " + file + "! (non-404 error)";
      }
    }
    isTainted = false;
  }
}

var realwidth = (t) => {
  if (!t.naturalWidth) {
    return setTimeout(realwidth, 10, t);
  }
  t.style.width = "initial";
}

function lazyload() {
  var imageObserver = new IntersectionObserver(function(entries, observer) {
    entries.forEach(function(e) {
      if (e.isIntersecting) {
        let t = e.target;
        t.src = t.dataset.src;
        setTimeout(realwidth, 10, t);
        imageObserver.unobserve(t);
      }
    });
  });

  var lazyloadImages = document.querySelectorAll(".lazy");
  lazyloadImages.forEach(function(e) {
    e.classList.remove("lazy");
    e.style.height = "200px";
    e.style.width = "300px";
    imageObserver.observe(e);
  });
}

function makedots(cs, pos, pre=false) {
  var newbar = [];

  if (cs.length == 1) {
    const d = document.createElement ("DIV");
    d.classList = "droponly";
    d.dataset.color = "droponly";
    d.dataset.tooltip = "drop only";
    d.innerHTML = "✨";
    if (pre) {
      return [d];
    } else {
      return d.outerHTML;
    }
  }

  const gradientbg = [];

  while (pos < cs.length) {
    var r1 = cs[pos];
    var r2 = cs[pos+1];
    var r3 = cs[pos+2];
    var bc = "rgba(0, 0, 0, 0.5)";
    var bt = r2;
    var tr = "";
    var st = "";
    if (r2%4 == 2){
      tr = "semi-translucent ";
    } else if (r2%4 == 3){
      tr = "translucent ";
    }
    if (r2 > 7) {
      tr += "metallic ";
      st = "✨";
      bt -= 8;
    } else if (r2 > 3) {
      tr += "pearlescent ";
      st = "💫";
      bt -= 4;
    }
    if (r1 == "black" || r1 == "galaxy") {
      bc = "#556";
      bt += 1;
    }
    if (r3 == 2){
      if (creative && creative.classList == "previous") {
        pos += 3;
        continue;
      }
      newbar[newbar.length-1][0].push(fc[r1]);
    } else {
      newbar.push([[fc[r1]], ""]);
    }
    newbar[newbar.length-1][1] += "<div style='display:inline-block; padding:0px 3px; cursor:pointer;' data-color='" + r1 + "' data-tooltip='" + tr + r1 + "'><div class='dot' style='pointer-events:none; height:" + (12-2*bt) + "px; width:" + (12-2*bt) + "px; border:" + bt + "px solid " + bc + "; background: transparent; color:rgba(255, 255, 255, 0.5); font-size:15px; filter: grayscale(100%);'>" + st + "</div></div>";
    pos += 3;
  }

  for (const color of newbar) {
    const width = 12 + color[0].length*18 - 18;
    const fcc = [];

    fcc.push(color[0][0] + " 6px");
    for (const [n, o] of color[0].entries()) {
      fcc.push(o + " " + (6+18*n) + "px");
    }
    fcc.push(color[0][color[0].length-1]);

    const d1 = document.createElement("DIV");
    d1.style.position = "absolute";
    d1.innerHTML = color[1];

    const d3 = document.createElement("DIV");
    d3.classList = "dot";
    d3.style = `pointer-events:none; height: 12px; width: ${width}px; border: none; background: linear-gradient(90deg, ${fcc.join(", ")});`;

    const d2 = document.createElement("DIV");
    d2.style.padding = "0 3px";
    d2.appendChild(d3);

    const di = document.createElement("DIV");
    di.style.display = "inline-block";
    di.appendChild(d1);
    di.appendChild(d2);
    gradientbg.push(di);
  }

  if (pre) {
    return gradientbg;
  } else {
    return gradientbg.map(x => x.outerHTML).join("");
  }
}

function galleryset2() {
  var buffer = "";
  for (const gset of galleryset[1]) {
    buffer += "<div class='frame'><a class='fileThumb' href='" + gset + "'><img class='lazy' data-src='" + gset + "'></a></div>";
  }
  gallery.insertAdjacentHTML("beforeend", buffer);
  lazyload();
  more.style.display = "none"; 
}

function cssel() {
  const links = document.querySelectorAll(".colorset");
  const orig_colorset = colorset ? colorset.replace(/(^cs\s|\smas$)/g, '') : false;
  for (const link of links) {
    if (colorset && link.innerHTML.toLowerCase().replace(/(^cs\s|'|\smas$)/g, '') == orig_colorset) {
      link.classList.add("colorsel");
    } else {
      link.classList.remove("colorsel");
    }
  }
}

function addtogallery(k) {
  const i = document.createElement("IMG");
  i.classList = "lazy";
  i.dataset.src = k;

  const a = document.createElement("A");
  a.classList = "fileThumb";
  a.href = k;
  a.appendChild(i);

  const d = document.createElement("DIV");
  d.classList = 'frame';
  d.appendChild(a);

  gallery.appendChild(d);
}

var galleryset = [[], []];
function makegallery() {
  if (!editor.innerHTML.startsWith("Connect to Bad Dragon")) {
    echo("Replace this text field with 'Connect to Bad Dragon' and release me from liability.\nThis might strain Bad Dragon server/your computer and I'll not be held responsible for that.\n")
    return;
  }

  more.style.display = "none";
  gallery.innerHTML = "";

  const bookmarks = editor.innerHTML.replace(/Bad Dragon\//g, "https://da6npmvqm28oa.cloudfront.net/inventory-toy-services/").replace(/\<br\>/g, "\n").split("\n").filter(function(e){return (e&&!e.startsWith("SHAME ")&&(e.toLowerCase().endsWith(".jpg")||e.toLowerCase().endsWith(".png")))});

  for (const bookmark of bookmarks) {
    addtogallery(bookmark);
  }

  for (const custom_twins of pictures["custom twins"]) {
    let featured = false;
    const k = Object.keys(custom_twins)[0];
    const ct = document.createElement("DIV");

    for (const cs of custom_twins[k]) {
      if (cs[0].toLowerCase().replace(/'/g, "") == colorset) {
        featured = true;
      }

      const d = document.createElement("DIV");
      d.innerHTML = "&gt;";

      const s = document.createElement("SPAN");
      s.classList = 'colorset';
      s.innerHTML = cs[0];

      d.appendChild(s);
      for (const dot of makedots(cs, 1, true)) {
        d.appendChild(dot);
      }
      ct.appendChild(d);
    }

    if (featured) {
      addtogallery(k);

      const di = document.createElement("DIV");
      di.style.display = "inline-block";
      di.style.verticalAlign = "top";
      di.appendChild(ct);

      gallery.appendChild(di);
    }
  }

  galleryset = [[], []];
  for (const [i, picture] of pictures[colorset].entries()) {
    if (i < 12) {
      galleryset[0].push(picture);
    } else {
      galleryset[1].push(picture);
    }
  }

  for (const gset of galleryset[0]) {
    addtogallery(gset);
  }

  cssel();
  lazyload();

  if (pictures[colorset].length>11){
    more.innerHTML = "Load " + (pictures[colorset].length-12) + " more pictures";
    more.style.display = "inline-block"; 
  }
}

function makelink(cs) {
  let c = colorsets[cs];
  let tt = "";
  if (c[0]) {
    if (Array.isArray(c[0])) {
      tt += [c[0][0], ...c[0].slice(2)].join("/");
      if (c[0][1]) {
        tt += ' ꍯ ' + c[0][1];
      }
    } else {
      tt += c[0];
    }
  }
  let lowkey = cs.toLowerCase();
  if (lowkey in swatches) {
    if (Array.isArray(swatches[lowkey])) {
      for (const ent of swatches[lowkey]) {
        tt += "<br>" + ent["description"] + "<br><img style='vertical-align:middle;' src='" + ent["swatchImage"] + "'>";
      }
    } else {
      tt += "<br>" + swatches[lowkey]["description"] + "<br><img style='vertical-align:middle;' src='" + swatches[lowkey]["swatchImage"] + "'>";
    }
    if (lowkey + " mas" in swatches) {
      const swatchmas = swatches[lowkey + " mas"]
      if (swatchmas["description"].toLowerCase().replace(/\./g, "") != swatches[lowkey]["description"].toLowerCase().replace(/\./g, "")) {
        tt += "<br> ꍯ " + swatchmas["description"] + "<br>";
      } else {
        tt += " ꍯ ";
      }
      tt += "<img src='" + swatchmas["swatchImage"] + "'>";
    } else if ("cs " + lowkey in swatches) {
      tt += " ꍯ Swap available";
    } else if (Array.isArray(c[0]) && c[0][1]) {
      tt += " ꍯ Swap N/A or naming issue";
    }
  }
  let s = document.createElement("SPAN");
  s.classList.add("colorset");
  if (Array.isArray(c[0])) {
    s.dataset.colorTheme = c[0][0];
    if (c[0][1]) {
      s.dataset.colorTheme2 = c[0][1];
    }
    if (c[0].length > 2) {
      s.dataset.colorTheme3 = c[0][2];
    }
    if (c[0].length > 3) {
      s.dataset.colorTheme4 = c[0][3];
    }
    if (c[0].length > 4) {
      s.dataset.colorTheme5 = c[0][4];
    }
  } else {
    s.dataset.colorTheme = c[0];
  }
  s.dataset.tooltip = tt;
  s.innerHTML = cs;
  return s;
}

function makeDIV(id, t, tooltip, pointer=false) {
  const d = document.createElement("DIV");
  d.classList = "next";
  d.id = id;
  d.dataset.tooltip = tooltip;
  d.innerHTML = t;

  if (pointer) {
    d.style.cursor = "pointer";
  }

  return d;
};

function makeUL(array) {
  const list = document.createElement('ul');
  list.style.whiteSpace = "nowrap";
  for (const i of Array(array.length).keys()) {
    const item = document.createElement('li');
    item.appendChild(document.createTextNode(array[i]));
    list.appendChild(item);
  }
  return list;
}

function colorline(b, cs) {
  const d = document.createElement("DIV");
  d.innerHTML = b;
  d.appendChild(makelink(cs));
  for (const dot of makedots(colorsets[cs], 1, true)) {
    d.appendChild(dot);
  }
  colorlist.appendChild(d);
}

function FFdown(e) {
  const t = e.target;
  if (link && t.tagName != "A") {
    link.classList.remove("tang");
    gallery_tooltip.style.display = "none";
  }

  if (t.id == "creative") {
    if (creative.classList == "next") {
      creative.classList = "previous";
    } else {
      creative.classList = "next";
    }
  } else if (t.id == "odnary") {
    colorset = odnary.dataset.colorset;
    makegallery();
  } else if (t.id == "replace") {
    more.style.display = "none"; 
    gallery.innerHTML = "";
    galleryset = [[], []];

    const lines = editor.innerHTML.replace(/Bad Dragon\//g, "https://da6npmvqm28oa.cloudfront.net/inventory-toy-services/").replace(/\<br\>/g, "\n").split("\n");
    const bookmarks = lines.filter((e) => {return (e&&!e.startsWith("SHAME ")&&(e.toLowerCase().endsWith(".jpg")||e.toLowerCase().endsWith(".png")))});
    for (const bookmark of bookmarks) {
      galleryset[0].push(bookmark);
    }

    for (const gset of galleryset[0]) {
      addtogallery(gset);
    }

    rainbow = [];
    for (const line of lines) {
      if (line in colorsets && colorsets[line] != true){
        let cs = colorsets[line];
        rainbowfade = false;
        for (var o=1; o<cs.length; o+=3) {
          rainbow.push(cs[o], 0, rainbowfade?2:0);
          rainbowfade = true;
          if (rainbow.length > 408*3) {
            rainbow = rainbow.slice(3);
            rainbow[2] = 0;
          }
        }
        rainbowfade = false;
      } else if (line == "palette") {
        for (const p of palette) {
          rainbowfade = false;
          for (const palett of p) {
            rainbow.push(palett, 0, rainbowfade?2:0);
            rainbowfade = true;
            if (rainbow.length > 408*3) {
              rainbow = rainbow.slice(3);
              rainbow[2] = 0;
            }
          }
          rainbowfade = false;
        }
      } else if (line in fc) {
        rainbow.push(line, 0, rainbowfade?2:0);
        rainbowfade = true;
        if (rainbow.length>408*3) {
          rainbow = rainbow.slice(3);
          rainbow[2] = 0;
        }
      } else {
        rainbowfade = false;
      }
    }

    rainbowfade = false;
    fadebar.innerHTML = "";
    for (const dot of makedots(rainbow, 0, true)) {
      fadebar.appendChild(dot);
    }
    const b = document.createElement("button");
    b.innerHTML = "ꍯ";
    b.classList = "dark";
    b.id = "fadeends";
    b.style.display = "none";
    b.addEventListener('click', () => {
      rainbowfade = false;
      fadeends.display = 'none';
    });
    b.dataset.tooltip = "Fade ends";
    fadebar.appendChild(b);

    colorset = undefined;
    cssel();
    lazyload();
  } else if (t.id == "gallerysave") {
    if (gallerysave.classList == "previous") {
      return;
    }

    const expires = new Date(Date.now() + 365 * 864e5).toUTCString();
    const h = editor.innerHTML.replace(/<br>/g, "\n").replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/");
    document.cookie = `gallerysave=${encodeURIComponent(h)}; expires=${expires}; path=/; SameSite=Strict;`;
    //no expiry would allow the cookie to be automatically deleted upon browser exit.
    gallerysave.classList = "previous";
    gallerysave.innerHTML = "Save completed";
  } else if (t.id == "cs") {
    colorset = cs.dataset.colorset;
    makegallery();
  } else if (t.id == "mas") {
    colorset = mas.dataset.colorset;
    makegallery();
  } else if (t.id == "more") {
    galleryset2();
  } else if (t.classList.contains("colorset")) {
    link = t;
    link.classList.add("tang");

    odnary.style.display = "none";
    cs.style.display = "none";
    mas.style.display = "none";

    const color = link.innerHTML.toLowerCase().replace(/'/g, "");
    if (Object.keys(pictures).includes(color)) {
      odnary.style.display = "inline-block";
      odnary.dataset.colorset = color;
    }
    if (Object.keys(pictures).includes("cs " + color)) {
      cs.style.display = "inline-block";
      cs.dataset.colorset = "cs " + color;
    }
    if (Object.keys(pictures).includes(color + " mas")) {
      mas.style.display = "inline-block";
      mas.dataset.colorset = color + " mas";
    }

    const listtoys = [];
    const ct = link.dataset.colorTheme;
    if (ct) {
      checkinv.style.display = "inline-block";
      checkinv.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct;
    } else {
      checkinv.style.display = "none";
    }
    if (toys[ct]) {
      listtoys.push(...toys[ct]);
    } else {
      listtoys.push("Unknown caller");
    }

    const ct3 = link.dataset.colorTheme3;
    if (ct3) {
      checkinv_2.style.display = "inline-block";
      checkinv_2.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct3;
      if (toys[ct3]) {
        listtoys.push(...toys[ct3].map((x) => {return "2 " + x}));
      } else {
        listtoys.push("2 Unknown caller");
      }
    } else {
      checkinv_2.style.display = "none";
    }

    const ct4 = link.dataset.colorTheme4;
    if (ct4) {
      checkinv_3.style.display = "inline-block";
      checkinv_3.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct4;
      if (toys[ct4]) {
        listtoys.push(...toys[ct4].map((x) => {return "3 " + x}));
      } else {
        listtoys.push("3 Unknown caller");
      }
    } else {
      checkinv_3.style.display = "none";
    }

    const ct5 = link.dataset.colorTheme5;
    if (ct5) {
      checkinv_4.style.display = "inline-block";
      checkinv_4.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct5;
      if (toys[ct5]) {
        listtoys.push(...toys[ct5].map((x) => {return "4 " + x}));
      } else {
        listtoys.push("4 Unknown caller");
      }
    } else {
      checkinv_4.style.display = "none";
    }

    const ct2 = link.dataset.colorTheme2;
    if (ct2) {
      checkinv_mas.style.display = "inline-block";
      checkinv_mas.href = "https://bad-dragon.com/shop/inventory?colorTheme=" + ct2;
      if (toys[ct2]) {
        listtoys.push(...toys[ct2].map((x) => {return "ꍯ " + x}));
      } else {
        listtoys.push("ꍯ Unknown caller")
      }
    } else {
      checkinv_mas.style.display = "none";
    }

    const UL = makeUL(listtoys);
    const rows = listtoys.length >= 20 ? 20 : listtoys.length;
    UL.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    checkcom.dataset.tooltip = UL.outerHTML;
    where = link.getBoundingClientRect();
    gallery_tooltip.style.left = (window.scrollX + where.left -2) + "px";
    gallery_tooltip.style.top = (window.scrollY + where.top -28) + "px";
    gallery_tooltip.style.display = "inline-block";
  } else if (t.dataset.schande) {
    var a = t.parentNode;
    var d = document.createElement("div");
    a.appendChild(d);
    t.addEventListener('touchmove', (e) => {e.preventDefault()});

    if (t.classList.contains("save")) {
      if (isTouch) {
        d.classList.add("right");
        const [x, y] = [e.pageX, e.pageY];
        const listener = (z) => {
          if (-20 < (y - z.pageY) && (y - z.pageY) < 20 && (z.pageX - x) > 50) {
            d.classList.remove("right");
            echo(t.dataset.schande);
            t.removeEventListener('touchend', listener);
            delete t.dataset.busy;
            edit();
          }
        };

        if (!t.dataset.busy) {
          t.addEventListener('touchend', listener);
          t.dataset.busy = true;
        }

        t.addEventListener('mouseleave', () => {
          d.classList.remove("right");
        });
      } else {
        const listener = () => {
          echo(t.dataset.schande);
          t.removeEventListener("mouseup", listener);
          edit();
        }
        t.addEventListener("mouseup", listener);
      }
    } else {
      if (isTouch) {
        d.classList.add("left");
        const [x, y] = [e.pageX, e.pageY];
        const listener = (z) => {
          if (-20 < (y - z.pageY) && (y - z.pageY) < 20 && (x - z.pageX) > 50) {
            d.classList.remove("left");
            echo("SHAME " + t.dataset.schande);
            t.removeEventListener('touchend', listener);
            delete t.dataset.busy;
            edit();
          }
        };

        if (!t.dataset.busy) {
          t.addEventListener('touchend', listener);
          t.dataset.busy = true;
        }

        t.addEventListener('mouseleave', () => {
          d.classList.remove("left");
        });
      } else {
        const listener = () => {
          echo("SHAME " + t.dataset.schande);
          t.removeEventListener("mouseup", listener);
          edit();
        }
        t.addEventListener("mouseup", listener);
      }
    }
  } else if (t.id == "exotic") {
    const colorsels = [];
    for (const key of Object.keys(colorsets)) {
      const k = colorsets[key];
      let featured = false;
      if (10 < k.length) {
        featured = true;
      } else {
        let pos = 1;
        while (pos < k.length) {
          if (k[pos+2] > 1) {
            featured = true;
            break;
          }
          pos += 3;
        }
      }
      if (featured) {
        colorsels.push(key);
      }
    }

    colorlist.innerHTML = "<h3>Exotic color sets</h3>";
    for (const cs of colorsels) {
      colorline("&gt; ", cs);
    }
    cssel();
  } else if (t.id == "droponly" || t.dataset.color == "droponly") {
    if (isTouch && t.hasAttribute("data-color") && t.hasAttribute("data-tooltip")) {
      return;
    }

    colorlist.innerHTML = "<h3>Drop only color sets</h3>";
    for (const css of Object.keys(colorsets)) {
      if (colorsets[css] == true || colorsets[css].length != 1) {
        continue;
      }

      colorline("&gt; ", css);
    }
    cssel();
  } else if (t.id == "viewall") {
    colorlist.innerHTML = "<h3>Choose a color!</h3>";
    for (const css of Object.keys(colorsets)) {
      if (colorsets[css] == true) {
        colorlist.insertAdjacentHTML("beforeend", css);
        continue;
      }

      colorline("&gt; ", css);
    }
    cssel();
  } else if (t.id == "numbered") {
    colorlist.innerHTML = "<h3>Choose a color!</h3>";

    const presorted = {};
    for (const css of Object.keys(colorsets)) {
      if (colorsets[css] == true) {
        continue;
      }

      id = colorsets[css][0];
      if (Array.isArray(id)) {
        for (const idp of id) {
          if (idp && !presorted[idp]) {
            presorted[idp] = css;
          }
        }
      } else if (id) {
        presorted[id] = css;
      }
    }

    let index = 1;
    for (const id of Object.keys(presorted)) {
      while (id > index) {
        const d = document.createElement("DIV");
        d.innerHTML = index.toString().padStart(4, ' ');
        colorlist.appendChild(d);
        index++;
      }
      index++;

      colorline(id.padStart(4, ' ') + " ", presorted[id]);
    }

    cssel();
  } else if (t.hasAttribute("data-color")) {
    if (isTouch && t.dataset.tooltip) {
      return;
    }

    const color = t.dataset.color;
    if (!color) {
      colorlist.innerHTML = "<h3>Choose a color!</h3>";
      return;
    }

    rainbow.push(color, 0, rainbowfade?2:0);
    rainbowfade = true;

    if (rainbow.length > 408*3) {
      rainbow = rainbow.slice(3);
      rainbow[2] = 0;
    }

    fadebar.innerHTML = "";
    for (const dot of makedots(rainbow, 0, true)) {
      fadebar.appendChild(dot);
    }
    const b = document.createElement("button");
    b.innerHTML = "ꍯ";
    b.classList = "dark";
    b.id = "fadeends";
    b.addEventListener('click', () => {
      rainbowfade = false;
      fadeends.style.display = 'none';
    });
    b.dataset.tooltip = "Fade ends";
    fadebar.appendChild(b);

    const god = creative.classList == "previous";
    const colorsels = [[], [], []];
    for (const key of Object.keys(colorsets)) {
      const k = colorsets[key];
      let featured = false;
      let pos = 1;
      let p = 0;
      while (pos < k.length) {
        if (k[pos] == color) {
          const pow = k[pos+1];
          p = pow ? pow-1 : 0;

          featured = true;
          if (god && k[pos+2] > 0) {
            featured = false;
          }
        }
        pos += 3;
      }
      if (featured) {
        colorsels[p].push(key);
      }
    }

    colorlist.innerHTML = "<h3>" + color[0].toUpperCase() + color.slice(1) + " (" + makedots([color, 0, 0], 0) + ") silicone</h3>";
    for (const [p, cs] of colorsels.reverse().entries()) {
      colorlist.insertAdjacentHTML("beforeend", ["Translucent<br>", "Semi-translucent<br>", "Solid<br>"][p]);
      for (const css of cs) {
        colorline("&gt; ", css);
      }
    }
    cssel();
  }
}

var link = false;
var cur = 0;
var downmove = false;
var busymoving, busypicker, busytyping;
var updatesel = false;
var updatelen = 0;
function FFup() {
  let sel = editor.ownerDocument.defaultView.getSelection();
  let len = sel.toString().length;
  let pos = sel.getRangeAt(0);
  if (link && link.classList.contains("hyperlink")) {
    link.classList.remove("tang");
    cursor_tooltip.style.display = "none";
  }
  link = sel.anchorNode.parentNode;
  let ans = false;
  if (link.classList.contains("hyperlink")) {
    link.classList.add("tang");
    where = link.getBoundingClientRect();
    cursor_tooltip.style.left = (window.scrollX + where.left + 6) + "px";
    cursor_tooltip.style.top = (window.scrollY + where.top + (where.top < 60?30:-30)) + "px";
    cursor_tooltip.innerHTML = "<a href='" + link.innerHTML + "' target='_blank' class='next' style='text-decoration:none; font-size:12px; font-family:sans-serif;'>Open</a>";
    cursor_tooltip.style.display = "inline-block";
  } else if (len > 0 && len < 256){
    if (!updatesel){
      updatesel = window.setInterval(function () {
        let sel = editor.ownerDocument.defaultView.getSelection();
        let len = sel.toString().length;
        if (len !== updatelen){
          updatelen = len;
          FFup()
        }
      }, 500);
    }
    try {
      ans = new Function('return ' + sel.toString().replace(/(\r|\n)/g, ""))().toFixed(10)*1;
    } catch {
      cursor_tooltip.style.display = "none"
    }
  } else {
    window.clearInterval(updatesel);
    updatesel = false;
    cursor_tooltip.style.display = "none";
  }
  let preCaretRange = pos.cloneRange();
  if(ans !== false){
    where = preCaretRange.getBoundingClientRect()
    cursor_tooltip.style.left = (window.scrollX + where.left) + "px";
    cursor_tooltip.style.top = (window.scrollY + where.top + 36) + "px";
    cursor_tooltip.innerHTML = "<span class='tangerine' style='font-size:14px;'>" + ans + "</span>";
    cursor_tooltip.style.display = "inline-block";
  };
  preCaretRange.selectNodeContents(editor);
  preCaretRange.setEnd(pos.endContainer, pos.endOffset);
  cur = preCaretRange.toString().length;
  calc.placeholder = "Ln:" + editor.textContent.substr(0, cur).split("\n").length + " Pos:" + cur;
}

function plaintext(e) {
  e.preventDefault();
  var text = e.clipboardData.getData('text/plain').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  document.execCommand('insertHTML', false, text);
}

function echo(B, b) {
  if (!b) {
    B = "\n" + B;
  } else {
    B = " " + B;
  }
  editor.insertAdjacentHTML("beforeend", B);
}

function edit() {
  const sel = editor.ownerDocument.defaultView.getSelection();
  if (sel.rangeCount) {
    const pos = sel.getRangeAt(0);
    const preCaretRange = pos.cloneRange();
    const where = preCaretRange.getBoundingClientRect()
    cursor_focus.style.left = (window.scrollX + where.left - 100) + "px";
    cursor_focus.style.top = (window.scrollY + where.top - 200) + "px";
    if (cursor_focus.offsetTop + 200 < window.pageYOffset || cursor_focus.offsetTop + 200 > window.pageYOffset+window.innerHeight || cursor_focus.offsetLeft + 100 < window.pageXOffset || cursor_focus.offsetLeft + 100 > window.pageXOffset+window.innerWidth) {
      cursor_focus.scrollIntoView({top: 0, behavior: "smooth", inline:"start"})
    }
  }

  const h = editor.innerHTML.replace(/<br>/g, "\n").replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/")
  const n = encodeURIComponent(h).length;
  gallerysave.innerHTML = "Save " + n + "/4085"
  if (4085 < n){
    gallerysave.classList = "previous";
  } else {
    gallerysave.classList = "next";
  }
}

var Expand = (c, t) => {
  if(!c.naturalWidth) {
    return setTimeout(Expand, 10, c, t);
  }
  c.style.maxWidth = "100%";
  c.style.display = "";
  t.style.display = "none";
  t.style.opacity = "";
};

var FFclick = (e) => {
  var t = e.target;
  var a = t.parentNode;
  if (a.classList != undefined && a.classList.contains("fileThumb")) {
    e.preventDefault();
    if (t.dataset.src) {
      var c = document.createElement("img");
      c.src = a.href;
      c.style.display = "none";
      a.appendChild(c);
      t.style.opacity = "0.75";
      setTimeout(Expand, 10, c, t);
    } else {
      a.firstChild.style.display = "";
      a.removeChild(t);
      outbound()
      a.offsetTop < window.pageYOffset && a.scrollIntoView({block: "start", behavior: "smooth"});
    }
  }
};

var outbound;
var FFover = (e) => {
  var t = e.target;
  var a = t.parentNode;
  if (a.classList != undefined && a.classList.contains("fileThumb") && !a.parentNode.dataset.busy) {
    a = a.parentNode;
    var d = document.createElement("div");
    d.innerHTML = "<div class='schande save'>Save</div><div class='schande' style='left:48px;'>Schande!</div>";
    a.appendChild(d);
    listener = (z) => {
      z.target.style.opacity = 1;
      if (z.target.classList.contains("schande")) {
        z.target.dataset.schande = (t.dataset.src ? t.dataset.src : t.src).replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/");
      }
      z.target.removeEventListener("mouseover", listener);
      let left = () => {
        z.target.style.opacity = 0.5;
        z.target.removeEventListener("mouseleave", left);
      }
      z.target.addEventListener("mouseleave", left);
    }
    d.addEventListener("mouseover", listener);
    outbound = () => {
      setTimeout(() => {
        a.removeChild(d);
      }, 1)
      delete a.dataset.busy;
      a.removeEventListener("mouseleave", outbound);
    }
    a.dataset.busy = true;
    a.addEventListener("mouseleave", outbound);
  }
}

var FFmove = (e) => {
  const t = e.target;
  if (t.dataset.tooltip) {
    tooltip.style.left = (e.pageX + 10) + "px";
    tooltip.style.top = (e.pageY + 10) + "px";
    tooltip.style.display = "inline-block";
    tooltip.innerHTML = t.dataset.tooltip;
    if (t.classList == "tangerine") {
      let left = () => {
        t.classList = "tangerine";
      }
      t.classList = "brown";
      t.addEventListener("mouseleave", left);
    }
  } else {
    tooltip.style.display = "none";
  }
}

var link, isTouch, gallerylist, creative, colorset, stdout, editor, editdiff, fadebar;
var rainbow = [];
var rainbowfade = false;
var fadesample = makedots(["sky blue", 0, 0, "copper", 0, 2, "chestnut", 0, 2], 0);
var dotsample = 'sky blue (' + makedots(["sky blue", 0, 0], 0) + ') copper (' + makedots(["copper", 0, 0], 0) + ') then chestnut (' + makedots(["chestnut", 0, 0], 0) + ')';
window.onload = () => {
  document.body.innerHTML = "";

  let d = document.createElement("DIV");
  d.id = "cursor_focus";
  document.body.appendChild(d);

  d = document.createElement("DIV");
  d.classList = "cursor_tooltip";
  d.id = "cursor_tooltip";
  document.body.appendChild(d);

  d = document.createElement("DIV");
  d.id = "tooltip";
  d.classList = "dark close_button cursor_tooltip";
  document.body.appendChild(d);

  d = document.createElement("DIV");
  d.id = "gallery_tooltip";

  let di = document.createElement("DIV");
  di.classList = "next";
  di.id = "odnary";
  di.style.cursor = "pointer";
  di.innerHTML = "Gallery";
  d.appendChild(di);

  for (const [n, c] of ["checkinv", "checkinv_2", "checkinv_3", "checkinv_4"].entries()) {
    const a = document.createElement("A");
    a.classList = "next";
    a.target = "_blank";
    a.id = c;
    a.innerHTML = n ? n + 1 + "🧺" : "🧺";
    d.appendChild(a);
  }

  di = document.createElement("DIV");
  di.classList = "next";
  di.id = "mas";
  di.style.cursor = "pointer";
  di.innerHTML = "Mas";
  d.appendChild(di);

  di = document.createElement("DIV");
  di.classList = "next";
  di.id = "cs";
  di.style.cursor = "pointer";
  di.innerHTML = "Swaps";
  d.appendChild(di);

  const a = document.createElement("A");
  a.classList = "next";
  a.target = "_blank";
  a.id = "checkinv_mas";
  a.innerHTML = "ꍯ🧺";
  d.appendChild(a);

  di = document.createElement("DIV");
  di.classList = "tangerine";
  di.id = "checkcom";
  di.style.padding = "4px";
  di.innerHTML = "🧸";
  d.appendChild(di);

  document.body.appendChild(d);

  const toolbar = document.createElement("DIV");
  document.body.appendChild(toolbar);

  d = document.createElement("DIV");
  d.id = "main";

  di = document.createElement("DIV");
  di.id = "colortable";
  d.appendChild(di);

  di = document.createElement("DIV");
  di.id = "minimap";
  d.appendChild(di);

  di = document.createElement("DIV");
  di.id = "colorlist";
  d.appendChild(di);

  di = document.createElement("DIV");
  di.style.verticalAlign = "top";

  stdout = document.createElement("DIV");
  stdout.classList = "stdout";
  stdout.style.padding = "4px 0 0 0";

  let hz = document.createElement("DIV");
  hz.style = "min-width:606px; white-space:nowrap;";

  let bp = document.createElement("DIV");
  bp.style = "padding:0 4px; display:inline-block;";
  bp.innerHTML = "🦦 -(Bookmarked pictures)";
  hz.appendChild(bp);

  bp = document.createElement("DIV");
  bp.classList = "next";
  bp.id = "replace";
  bp.style.cursor = "pointer";
  bp.innerHTML = "Replace gallery";
  hz.appendChild(bp);

  bp = document.createElement("DIV");
  bp.classList = "previous";
  bp.id = "gallerysave";
  bp.style.cursor = "pointer";
  bp.dataset.tooltip = "Save text field as cookie for next page visit";
  bp.innerHTML = "Save";
  hz.appendChild(bp);

  calc = document.createElement("INPUT");
  calc.classList = "next";
  calc.id = "calc";
  calc.style.width = "100px";
  calc.type = "text";
  calc.placeholder = "Calculator";
  hz.appendChild(calc);

  stdout.appendChild(hz);

  editor = document.createElement("DIV");
  editor.classList = "editor";
  editor.style.display = "inline-block";
  editor.setAttribute("contenteditable", "plaintext-only");
  editor.spellcheck = false;
  editor.innerHTML = "<br>";
  stdout.appendChild(editor);

  editdiff = document.createElement("DIV");
  editdiff.classList = "editor";
  editdiff.style.display = "none";
  editdiff.setAttribute("contenteditable", "plaintext-only");
  editdiff.spellcheck = false;
  editdiff.innerHTML = "<br>";
  stdout.appendChild(editdiff);

  di.appendChild(stdout);

  hz = document.createElement("DIV");
  hz.id = "gallery";
  hz.style.display = "inline-block";
  di.appendChild(hz);

  hz = document.createElement("DIV");
  hz.classList = "next";
  hz.id = "more";
  di.appendChild(hz);

  d.appendChild(di);
  document.body.appendChild(d);

  toolbar.appendChild(makeDIV("creative", "Creative mode", "Unload color sets of selected color not possible for custom<br>&gt; Fade toy's midway and bottom colors<br>&gt; Silicones exclusive to wereables<br>&gt; Non-white highlights<br>&gt; Silicones covered by full cover highlights"));

  toolbar.appendChild(makeDIV("viewall", "View all", "Can't find a color set? Try this &amp; use your browser's find in page function!", true));

  toolbar.appendChild(makeDIV("numbered", "Numbered", "View color sets in order of color theme ID", true));

  d = document.createElement("DIV");
  d.classList = "tangerine";
  d.style.padding = "4px";
  d.dataset.tooltip = `• Choose several colors e.g. ${dotsample} for ${fadesample} fade bar to appear, as way to test as well as to anticipate for blend/smear issue.<br>• Write color name or color set name in text field of bookmarked pictures to manipulate fade bar.<br>&nbsp; ◦ <div class='next'>Replace gallery</div> to replace fade bar with written color names.<br>&nbsp; ◦ <div class='next'>Save</div> to save fade bar for next page visit.<br>&nbsp; ◦ Fade ends on non-color line.<br><br>Be mindful of translucent silicones<br>• Translucent silicones may overpower to each other especially darkened and/or pigmented ones if not become dull or muddled.<br>• Use fade bar for blend test of translucent silicones, they become pronounced of that.<br>• Solid silicones can create contours on translucent silicones or 3D depth behind translucent silicones.<br>Open <div class='next'>Gallery</div> for color set named <span class='colorset'>Arctic Ice</span>${makedots(['sky blue', 3, 0], 0)} from sky blue (${makedots(['sky blue', 0, 0], 0)}) color group for photo example of translucent silicone.`;
  d.innerHTML = ":?:";
  toolbar.appendChild(d);

  fadebar = document.createElement("DIV");
  fadebar.style.display = "inline-block";
  toolbar.appendChild(fadebar);

  d = document.createElement("DIV");
  d.classList = "dark local_tooltip";
  d.id = "local_tooltip";
  toolbar.appendChild(d);

  loadcolors("colorsets.json");
  loadcolors("pictures.json");
  loadcolors("swatches.json");
  loadcolors("toys.json");

  for (const ccn of cn) {
    const d = document.createElement("DIV");
    d.classList = "cell";

    const m = document.createElement("DIV");
    m.classList = "cell minicell";

    if (ccn == null) {
      d.dataset.color = "";
    } else {
      const cc = fc[ccn];
      let cb = "#000000";

      // if (!cc || parseInt(cc.slice(1, 3), 16) < 144 && parseInt(cc.slice(3, 5), 16) < 144 && parseInt(cc.slice(5), 16) < 144) {
      //   cb = "rgba(255, 255, 255, 0.5)";
      // }

      d.style.verticalAlign = "top";
      d.style.background = cc;
      d.style.color = cb;
      d.dataset.color = ccn;
      d.innerHTML = ccn;

      m.style.background = cc;
    }

    colortable.appendChild(d);
    minimap.appendChild(m);
  }

  d = document.createElement("DIV");
  d.id = "droponly";
  //d.dataset.color = "droponly";
  d.dataset.tooltip = "View drop only color sets (unavailable for custom ordering)";
  d.classList = "cell";
  d.innerHTML = "✨";
  colortable.appendChild(d);

  d = document.createElement("DIV");
  d.id = "exotic";
  //d.dataset.color = "droponly";
  d.dataset.tooltip = "View all color sets using fades or 4+ color marbles i.e. can't be altered"
  d.classList = "cell";
  d.style.color = "rgba(255, 255, 255, 0.5)";
  d.innerHTML = "Exotic";
  colortable.appendChild(d);

  d = document.createElement("DIV");
  d.dataset.color = "???";
  d.dataset.tooltip = "View color sets with unassigned silicone colors";
  d.classList = "cell";
  d.style.color = "rgba(255, 255, 255, 0.5)";
  d.innerHTML = "UNK";
  colortable.appendChild(d);

  colorlist.innerHTML = "<h3>Choose a color!</h3>";
  document.addEventListener("click", FFclick);
  document.addEventListener("mousemove", FFmove);
  document.addEventListener("mouseover", FFover);
  //document.addEventListener("touchstart", FFdown);
  document.addEventListener("mousedown", FFdown);

  creative = document.getElementById("creative");

  editor.addEventListener("mouseup", FFup);

  editor.onmousedown = () => {
    downmove = true;
  };

  editor.onmouseup = () => {
    downmove = false;
  };

  editor.onmousemove = () => {
    if(downmove == true){
      clearTimeout(busymoving)
      busymoving = setTimeout(FFup, 100)
    }
  };

  editor.oninput = () => {
    edit();
  };

  if (!editor.isContentEditable) {
    editor.setAttribute("contenteditable", true);
    editor.onpaste = (e) => {
      plaintext(e);
    };

    editdiff.setAttribute("contenteditable", true);
    editdiff.onpaste = (e) => {
      plaintext(e);
    };
  }

  if ('ontouchstart' in window) {
    isTouch = true;
  }

  var fileThumb;
  document.addEventListener("dragstart", (e) => {
    if (e.target.className == 'fileThumb'){
      fileThumb = e.target;
    }
  }, false);

  editor.addEventListener("drop", (e) => {
    if (fileThumb) {
      e.preventDefault();
      echo(fileThumb.childNodes[0].src.replace(/https:\/\/da6npmvqm28oa.cloudfront.net\/inventory-toy-services\//g, "Bad Dragon/"));
      edit();
      fileThumb = null;
    }
  }, false);

  const cookies = document.cookie.split(';');
  for (const cookie of cookies) {
    let c = cookie;

    while (c.charAt(0) == ' '){
      c = c.substring(1, c.length);
    };

    if (c.indexOf("gallerysave=") == 0) {
      editor.innerHTML = decodeURIComponent(c.substring("gallerysave=".length, c.length));
    }
  }

  calc.addEventListener("keyup", (e) => {
    let c = calc.value;
    if (!c) {
      calc.style.backgroundColor = "#066";
    } else if (e.keyCode === 13) {
      try {
        calc.value = new Function('return ' + c)().toFixed(10)*1;
      } catch {
        if (c.startsWith("u")) {
          calc.value = deuni("\\" + c);
        }
      }
    } else {
      try {
        new Function('return ' + c)();
        calc.style.backgroundColor = "#066";
      } catch {
        if (c.startsWith("u") && (!c.slice(1) || Number('0x'+c.slice(1)))) {
          if (c.length == 5) {
            calc.style.backgroundColor = "#066";
          } else if (c.length > 5) {
            calc.style.backgroundColor = "#399";
          } else if (c.length < 5) {
            calc.style.backgroundColor = "#033";
          }
        } else {
          calc.style.backgroundColor = "#399";
        }
      }
    }
  });
}
</script></head><body class="exitmenu">1. Set up and run Schande.bat for its HTTP server from <a href="https://github.com/Rukario/Schande">https://github.com/Rukario/Schande</a>
2. Take me to Schande.bat, then launch <a href="http://127.0.0.1:8886/Color Gallery.html">http://127.0.0.1:8886/Color Gallery.html</a></body></html>
