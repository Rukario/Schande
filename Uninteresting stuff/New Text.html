<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="format-detection" content="telephone=no">
<title>🦊.txt</title>
<style>
html,body {caret-color:#ff8228; font-family:courier; font-size:14px; white-space:pre-wrap; margin-bottom:-2px; padding-top:2px; padding:2px;}
[contenteditable]:focus {outline: none;}
.editor {padding-top:40px; min-width:calc(100% - 20px); min-height:81vh; line-height:1.1;}
a {color:#ff9449;}
a:visited {color:#ffc66d;}
input[type="file"] {display: none;}
input[type="color"] {width:0; height:0; padding:0; margin:0; border:0; opacity:0;}
.next {color:#6fe; background-color:#066; border:1px solid #033; border-radius:0px; padding:4px 11px; margin:2px;}
::placeholder {color:#3cb;}
.prev {color:#6fe; background-color:#399; border:1px solid #033; border-radius:0px; padding:4px 11px; margin:2px;}
.tooltip {background:none; border:1px solid #772227; color:inherit; cursor:default; padding:6px 11px 4px;}
.menu {color:#9b859d; background-color:#110c13;}
.exitmenu {color:#f45; background-color:#2d0710;}
::selection {background:#ffb7b7;}

/*
My red modification of https://github.com/highlightjs/highlight.js/blob/master/src/styles/railscasts.css
Railscasts-like style (c) Visoft, Inc. (Damien White)
*/

.hljs {
  display: block;
  overflow-x: auto;
  //padding: 0.5em;
  //background: #2d0710;
  //color: #f45;
}

.hljs-comment,
.hljs-quote {
  color: #aabbcc;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag {
  color: #e3ceab;
}

.hljs-string,
.hljs-number,
.hljs-regexp,
.hljs-variable,
.hljs-template-variable {
  color: #88cc44;
}

.hljs-subst {
  color: #229922;
}

.hljs-tag,
.hljs-name {
  color: #e8bf6a;
}

.hljs-type {
  color: #da4939;
}


.hljs-symbol,
.hljs-bullet,
.hljs-built_in,
.hljs-builtin-name,
.hljs-attr,
.hljs-link {
  color: #6d9cbe;
}

.hljs-params {
  color: #d0d0ff;
}

.hljs-attribute {
  color: #cda869;
}

.hljs-meta {
  color: #9b859d;
}

.hljs-title,
.hljs-section {
  color: #ffc66d;
}

.hljs-addition {
  background-color: #144212;
  color: #e6e1dc;
  display: inline-block;
  width: 100%;
}

.hljs-deletion {
  background-color: #600;
  color: #e6e1dc;
  display: inline-block;
  width: 100%;
}

.hljs-selector-class {
  color: #9b703f;
}

.hljs-selector-id {
  color: #8b98ab;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-link {
  text-decoration: underline;
}
</style>
<script>
var FFdown = function(e) {
  var t = e.target;
  var a = t.parentNode;
  if (t.hasAttribute("data-tooltip")) {
    tooltip.style.display = "inline-block";
    tooltip.innerHTML = t.getAttribute("data-tooltip");
    let left = () => {
      setTimeout(function(){
        tooltip.style.display = "none";
      }, 1250)
      a.removeEventListener("mouseleave", left);
    }
    a.addEventListener("mouseleave", left);
  }
}

document.addEventListener("click", FFdown);

function pos() {
  let sel = editor.ownerDocument.defaultView.getSelection().getRangeAt(0);
  let preCaretRange = sel.cloneRange();
  preCaretRange.selectNodeContents(editor);
  preCaretRange.setEnd(sel.endContainer, sel.endOffset);
  let cur = preCaretRange.toString().length;
  calc.placeholder = "Ln:" + editor.textContent.substr(0, cur).split("\n").length + " Pos:" + cur;
}

function plaintext(elem, e) {
  e.preventDefault();
  var text = e.clipboardData.getData('text/plain').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  document.execCommand('insertHTML', false, text);
}

function edit() {
  if (!(document.title.includes(' *'))){
    document.title = document.title + ' *';
  }
}

function menu(){
  document.body.className = "menu"
  var x = document.getElementById("dimm");
  x.style.display = "block";
  var x = document.getElementById("dim");
  x.style.display = "none";
}

function exitmenu(){
  document.body.className = "exitmenu"
  var x = document.getElementById("dimm");
  x.style.display = "none";
  var x = document.getElementById("dim");
  x.style.display = "block";
}

function rename(){
  var newtitle = prompt("Use Save Text shortcut or download function from dropdown to save the document with this file name.", document.title.replace(" *", ""));
  if (newtitle){
    document.title = newtitle;
  }
}

function debar(x){
  return x.replace(/^.*?Text: .*?\)/, "");
}

function dedup(){
  dirty = editor.textContent.split("\n");
  clean = []
  for(var i=0;i<dirty.length;i++){
    if(dirty[i] && clean.indexOf(dirty[i])<0){
      clean.push(dirty[i]);
    } else {
      clean.push("");
    }
  }
  toolbar(clean.join("\n"));
};

function denew(){
  var dirty = editor.textContent.split("\n");
  clean = [];
  for(var i=0;i<dirty.length;i++){
    if(dirty[i]){
      clean.push(dirty[i]);
    }
  }
  toolbar(clean.join("\n"));
}

function detab(){
  toolbar(editor.textContent.replace(/	/g, "    "));
}

function decode(){
  try {
    toolbar(decodeURIComponent(editor.textContent));
  } catch {
    alert("The percent sign in this document appears malformed and has killed decoder!");
  }
}

function unraw(str) {
  return str.replace(/\\[0-9]|\\['"\bfnrtv]|\\x[0-9a-f]{2}|\\u[0-9a-f]{4}|\\u\{[0-9a-f]+\}|\\./ig, match => {
    switch (match[1]) {
      case "'":
      case "\"":
      case "\\":
        return match[1];
      case "b":
        return "\b";
      case "f":
        return "\f";
      case "n":
        return "\n";
      case "r":
        return "\r";
      case "t":
        return "\t";
      case "v":
        return "\v";
      case "u":
        if (match[2] === "{") {
          return String.fromCodePoint(parseInt(match.substring(3), 16));
        }
        return String.fromCharCode(parseInt(match.substring(2), 16));
      case "x":
        return String.fromCharCode(parseInt(match.substring(2), 16));
      case "0":
        return "\0";
      default:
        return match.substring(1);
    }
  });
}

function replace(x, y){
  var x = document.getElementById("replace");
  if(!x.value){
    toolbar(editor.textContent);
  } else {
    var y = document.getElementById("with");
    var r = new RegExp(x.value, 'g');
    toolbar(editor.textContent.replace(r, unraw(y.value)));
  }
}

function fraktur(){
  var x = editor.textContent
  var str = '';
  var c = '';

  for (var ch of x) {
    ch = '0x' + ch.codePointAt(0).toString(16)
    if (ch >= 0x41 && ch <= 0x5a) {
      c = ch - 0x41 + 0x1d56c;
    } else if (ch >= 0x61 && ch <= 0x7a) {
      c = ch - 0x61 + 0x1d586;
    } else {
      c = ch;
    }
    str += String.fromCodePoint(c);
  }
  toolbar(str);
}

function check(e){
  if (!e.value){
    e.style.backgroundColor = "#066"
  } else {
    try {
      new Function('return ' + e.value)();
      e.style.backgroundColor = "#066";
    } catch {
      e.style.backgroundColor = "#399";
    }
  }
}

function save(){
  var sav = new Blob([editor.textContent], {type: "application/octet-stream"});
  var a = document.createElement("a");
  a.href = URL.createObjectURL(sav);
  a.download = document.title.replace(" *", "");
  a.click();
}

function render(){
  let w = document.getElementById("togglediff");
  let e = document.getElementById("editable").textContent;
  let a = document.getElementById("saver");
  var t = document.title.replace(" *", "");
  var d = {"stderr1":false, "stderr2":false, "ask":(a.getAttribute("data-ask") === "true"), "dir":"", "name":t, "body":""}
  if (w.innerHTML == "File 2"){
    d["stderr1"] = "Cannot save while File 2 is active!";
    d["stderr2"] = "Please switch to File 1 before saving.";
  } else {
    var b = e.split('\n', 4).join("\n");
    for (var i=0;i<dirs.length;i++){
      n = dirs[i].split(" for ");
      nn = n[1].split(" ");
      var rx = new RegExp(nn[0], 'g');
      if(t.match(rx)){
        rx = new RegExp(nn[1], 'g')
        if(b.match(rx)){
          d["dir"] = n[0]
          break;
        };
      };
    };
    d["body"] = e;
  }
  document.body.textContent = JSON.stringify(d);
}

function diff(e, a){
  if (e.classList.contains("next")){
    e.classList.remove("next");
    e.classList.add("prev");
    e.setAttribute("data-html-original", e.innerHTML);
    e.innerHTML = a;
    let d = editdiff.textContent.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").split("\n");
    let di = editor.textContent.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").split("\n");
    for (var i=0;i<d.length;i++){
      if(d[i] !== di[i]){
        d[i] = "<span class='menu'>" + d[i]
        break
      }
    }
    editdiff.innerHTML = d.join("\n") + "</span>";
    editor.style.display = "none";
    editdiff.style.display = "inline-block";
  } else {
    e.classList.remove("prev");
    e.classList.add("next");
    e.innerHTML = e.getAttribute("data-html-original");
    editdiff.style.display = "none";
    editor.style.display = "inline-block";
  }
}

function open(file) {
  var fr = new FileReader();
  fr.readAsText(file);
  fr.onload = () => {
    toolbar(fr.result);
  }
}

function opendiff(file){
  var fr = new FileReader();
  fr.readAsText(file);
  fr.onload = () => {
    editdiff.innerHTML = fr.result.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }
  let d = document.getElementById("togglediff")
  d.style.display = "inline-block";
  d = document.getElementById("exittogglediff")
  d.style.display = "none";
}

function toolbar(d){
  document.body.className = "exitmenu";
  document.body.innerHTML = d.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  if (hljs) hljs.highlightElement(document.body);
  document.body.innerHTML = `<div style="position:fixed; white-space:nowrap; background-color:inherit;"><div id="dimm" style="font-size:14px; display:none;"><button class="prev" onclick="exitmenu();">🦊 -(Destructive tools)</button> 🦊 -(<select id="destructive" class="next" style="max-width:100px;">
    <option value="0">Remove...</option>
    <option value="1">Remove all duplicate lines</option>
    <option value="2">Remove all new lines</option>
    <option value="3">Replace all tabs with 4 spaces each</option>
    <option value="4">Decode all percent signs</option>
</select> or <input id="replace" class="next" style="padding:5px 10px 4px; width:86px;" type="text" placeholder="Replace...">→<input id="with" class="next" style="padding:5px 10px 4px; width:88px;" type="text" placeholder="none">) <button class="next" onclick="fraktur();">🦊 -(𝕱𝖗𝖆𝖐𝖙𝖚𝖗)</button> (can't be undone)</div><div id="dim" style="font-size:14px; display:block;"><label><input id="colorpicker" type="color" value="#2d0710"></input><button class="next" onclick="menu()">🦊 -(Destructive tools)</button><input id="calculator" class="next" style="padding:5px 10px 4px; width:116px;" type="text" oninput="check(this);" placeholder="Quick Calculator"> 🦊 -(<select id="opener" class="next" style="padding:5px 12px 4px; max-width:70px;">
    <option value="0">Open</option>
    <option value="1">Red/Railscasts</option>
    <option value="2">Under sunlight</option>
</select><label class="next" style="padding:5px 12px 4px; margin:2px; font-family:arial;"><input type="file" id="picker"></input>File</label><label id="exittogglediff" class="next" style="padding:5px 12px 4px; font-family:arial;"><input type="file" id="pickerdiff"></input>Diff</label><button class="next" id="togglediff" style="display:none;" onclick="diff(this, 'File 2')">File 1</button>) <button class="next" onclick="rename();">🦊 -(Save as)</button> 🦊 -(<select id="saver" class="next" style="max-width:145px;" data-ask=false>
    <option value="0">Save Text: iCloud</option>
    <option value="1">Save Text: Ask</option>
    <option value="2">Download</option>
</select>)</label> <div id="highlight" class="tooltip" style="display:none;" data-tooltip='Save <a href="https://highlightjs.org/download/" target="_blank">highlight.min.js</a> next to HTML then reload this page<br/> &gt; I recommend custom package with several languages you need.<br/> &gt; Most common language: HTML/XML, JavaScript, Python.'>🦊 -(Highlight)</div></div><div id="tooltip" style="white-space:initial; padding:0px 8px; font-family:sans-serif; font-size:90%; z-index:9999999; left:0px; top:0px; right:initial;"></div></div><div class="editor" id="editable" style="display:inline-block;" contenteditable="plaintext-only" spellcheck=false>` + document.body.innerHTML.replace(/(https:\/\/.*?)(\"|\'|\n|<|\)| )/g, '<a href="$1" target="_blank" contenteditable=false>$1</a>$2') + `</div><div class="editor" id="editable2" style="display:none;" contenteditable="plaintext-only" spellcheck=false></div>`;
  tooltip = document.getElementById("tooltip");
  editor = document.getElementById("editable");
  let left = () => {
    setTimeout(function(){
      tooltip.style.display = "none";
    }, 40)
    editor.removeEventListener("click", left);
  }
  if (window.location.search.includes("?") && !d){
    tooltip.style.display = "inline-block";
    tooltip.innerHTML = "The clipboard is updated with page source, paste to view!";
    editor.addEventListener("click", left);
  }
  editor.addEventListener("mouseup", pos);
  editdiff = document.getElementById("editable2");
  editor.setAttribute("oninput", "edit();");
  editor.setAttribute("onselect", "selected();");
  if(!editor.isContentEditable){
    if(!d){
      tooltip.style.display = "inline-block";
      tooltip.innerHTML = `Performance reduced: The JavaScript version is now used for compatibility of some feature on this browser.`;
      editor.addEventListener("click", left);
    }
    editor.setAttribute("onpaste", "plaintext(this, event)");
    editor.setAttribute("contenteditable", "true");
    editdiff.setAttribute("onpaste", "plaintext(this, event)");
    editdiff.setAttribute("contenteditable", "true");
  }
  var colorpicker = document.getElementById("colorpicker");
  colorpicker.addEventListener('change', (event) => {
    var s = document.createElement("style")
    calc.placeholder = event.target.value;

    var v = event.target.value.replace(/#/, "").match(/.{1,2}/g);
    if(v[0] >= "cc" || v[1] >= "cc" || v[2] >= "cc"){
      s.innerHTML = ".exitmenu{background-color:" + event.target.value + "; color:#586e75;}"
    } else if(v[0] >= "66" || v[1] >= "66" || v[2] >= "66"){
      s.innerHTML = ".exitmenu{background-color:" + event.target.value + "; color:#000;}"
    } else if(v[0] >= "20" && v[1] >= "07" && v[2] >= "07"){
      s.innerHTML = ".exitmenu{background-color:" + event.target.value + "; color:#f45;}"
    } else {
      s.innerHTML = ".exitmenu{background-color:" + event.target.value + "; color:#fff;}"
    }

    if(false && event.target.value == "#000000"){
      s.innerHTML = ".exitmenu{background-color:#000; color:#fff;}"
    } else if(false) {
      s.innerHTML = ".exitmenu{background-color:" + event.target.value + "; color:#f45;}"
    }

    document.body.appendChild(s)
  });
  var picker = document.getElementById("picker");
  picker.addEventListener('change', (event) => {
    file = event.target.files[0];
    document.title = file.name;
    open(file);
  });
  var pickerdiff = document.getElementById("pickerdiff");
  pickerdiff.addEventListener('change', (event) => {
    opendiff(event.target.files[0]);
  });
  calc = document.getElementById("calculator");
  calc.addEventListener("keyup", function(e) {
    if (e.keyCode === 13) {
      try {
        calc.value = new Function('return ' + calc.value)().toFixed(10)*1;
      } catch {
      }
    }
  });
  var opener = document.getElementById("opener");
  opener.addEventListener('change', (e) => {
    var x = e.target.selectedIndex;
    if (x == 1){
      var s = document.createElement("style")
      calc.placeholder = "#2d0710";
      s.innerHTML = ".exitmenu{background-color: #2d0710; color:#f45;}"
      document.body.appendChild(s)
    } else if (x == 2){
      var s = document.createElement("style")
      calc.placeholder = "#000000";
      s.innerHTML = ".exitmenu{background-color: #000000; color:#fff;}"
      document.body.appendChild(s)
    }
    e.target.selectedIndex = 0
  });
  var saver = document.getElementById("saver");
  saver.addEventListener('change', (e) => {
    var t = e.target;
    var x = t.selectedIndex;
    if (x == 0){
      t.setAttribute("data-ask", false);
    } else if (x == 1){
      t.setAttribute("data-ask", true);
    } else if (x == 2){
      e.target.selectedIndex = 1
      t.setAttribute("data-ask", true);
      save();
    }
  });
  var destructive = document.getElementById("destructive");
  destructive.addEventListener('change', (e) => {
    var x = e.target.selectedIndex;
    if (x == 1){
      dedup();
    } else if (x == 2){
      denew();
    } else if (x == 3){
      detab();
    } else if (x == 4){
      decode();
    }
    e.target.selectedIndex = 0
  });
  var y = document.getElementById("replace");
  y.addEventListener("keyup", function(e) {
    if (e.keyCode === 13) {
      replace();
    }
  });
  var z = document.getElementById("with");
  z.addEventListener("keyup", function(e) {
    if (e.keyCode === 13) {
      replace();
    }
  });
}

var calc, editor, editdiff, tooltip, highlight;
var dirs = [];
var hljs = false;
window.onload = () => {
  if (document.body.getAttribute("data-launch")){
    render();
    return;
  } else {
    document.body.setAttribute("data-launch", true);
  }
  var scale = "26px";
  if (window.screen.width > 800){
    scale = "14px";
  }
  document.body.style.fontSize = scale
  document.body.style.lineHeight = scale
  highlight = document.createElement("script");
  highlight.src = "highlight.min.js"/* + Date.now()*/;
  document.body.appendChild(highlight);
  toolbar("");
  highlight.onerror = () => {
    document.getElementById("highlight").style.display = "inline-block";
  }
}
</script>
<body class="exitmenu">1. Set up and run Schande.bat for its HTML server from <a href="https://github.com/Rukario/Schande">https://github.com/Rukario/Schande</a>
2. Take me to Schande.bat, then launch <a href="http://localhost:8886/New Text.html">http://localhost:8886/New Text.html</a></body></html>
